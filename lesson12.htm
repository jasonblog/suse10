<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=big5">
<title>柏青哥的 SuSE Linux -- 架設 DNS Server</title>
<style type="text/css">
<!--
a {
	color: #000099;
	text-decoration: none;
}
-->
</style>
</head>

<body background="../sumtextb.jpg" tppabs="http://www.suse.url.tw/sumtextb.jpg" link="#000099" vlink="#000099" alink="#000099" leftmargin="40">
<div align="left"> <font size="+1"><a href="index-1.htm" tppabs="http://www.suse.url.tw/sles10/index.htm" target="_blank">　<img src="../first.GIF" tppabs="http://www.suse.url.tw/first.GIF" width="40" height="40" border="0" align="middle"></a>　　</font>作者：陳柏菁<font size="+1">　</font>E-mail：pachingko@ms96.url.com.tw 
  <table width="100%" border="0">
    <tr> 
      <td nowrap> <div align="left"></div>
        <div align="center"><font size="+1"><font color="#000000" size="7"><strong>第十二章　架 
          設 DNS Server</strong></font></font></div>
        <div align="center"></div></td>
    </tr>
  </table>
  <font color="#660066"><br>
  </font><font size="+1"><strong><font color="#000099">索引：</font></strong><br>
  </font> 
  <table width="100%" border="0">
    <tr> 
      <td colspan="3"><font color="#000099"><strong>12.1 <a href="#1">DNS 的相關說明</a></strong></font></td>
    </tr>
    <tr> 
      <td width="4%"><font color="#000099">&nbsp;</font></td>
      <td width="6%" align="center" valign="top" nowrap><font color="#000099">12.1.1</font></td>
      <td width="90%"><a href="#2">DNS 簡介</a></td>
    </tr>
    <tr> 
      <td><font color="#000099">&nbsp;</font></td>
      <td align="center" valign="top" nowrap><font color="#000099">12.1.2</font></td>
      <td><a href="#3">DNS 的網域名稱空間</a></td>
    </tr>
    <tr> 
      <td colspan="3"><font color="#000099"><strong>12.2 <a href="#4">DNS 的查詢流程</a></strong></font></td>
    </tr>
    <tr> 
      <td><font color="#000099">&nbsp;</font></td>
      <td align="center" valign="top" nowrap><font color="#000099">12.2.1</font></td>
      <td><font color="#000099"><a href="#5">與名稱查詢有關的檔案</a> ---<br>
        <a href="#6">/etc/hosts</a> 、 <a href="#7">/etc/resolv.conf</a>、<a href="#8">/etc/nsswitch.conf</a></font></td>
    </tr>
    <tr> 
      <td><font color="#000099">&nbsp;</font></td>
      <td align="center" valign="top" nowrap><font color="#000099">12.2.2</font></td>
      <td><font color="#000099"><a href="#9">DNS 查詢流程</a> --- <a href="#10">正解查詢</a>、<a href="#11">反解查詢</a></font></td>
    </tr>
    <tr> 
      <td height="19"><font color="#000099">&nbsp;</font></td>
      <td align="center" valign="top" nowrap><font color="#000099">12.2.3</font></td>
      <td><a href="#12">DNS 的查詢模式</a></td>
    </tr>
    <tr> 
      <td colspan="3"><font color="#000099"><strong>12.3 <a href="#13">zone 的概念、網域申請及 
        DNS 類別</a></strong></font></td>
    </tr>
    <tr> 
      <td><font color="#000099">&nbsp;</font></td>
      <td align="center" valign="top" nowrap><font color="#000099">12.3.1</font></td>
      <td><a href="#14">zone 與 domain 的區別</a></td>
    </tr>
    <tr> 
      <td><font color="#000099">&nbsp;</font></td>
      <td align="center" valign="top" nowrap><font color="#000099">12.3.2</font></td>
      <td><font color="#000099"><a href="#15">網域名稱的申請</a> --- <a href="#16">完成正解授權</a></font></td>
    </tr>
    <tr> 
      <td><font color="#000099">&nbsp;</font></td>
      <td align="center" valign="top" nowrap><font color="#000099">12.3.3</font></td>
      <td><a href="#17">DNS 的類別</a></td>
    </tr>
    <tr> 
      <td colspan="3"><font color="#000099"><strong>12.4 <a href="#18">安裝 DNS 
        所需套件</a></strong></font></td>
    </tr>
    <tr> 
      <td colspan="3"><font color="#000099"><strong>12.5 <a href="#19">設定 DNS 
        Server</a></strong></font></td>
    </tr>
    <tr> 
      <td><font color="#000099">&nbsp;</font></td>
      <td align="center" valign="top" nowrap><font color="#000099">12.5.1</font></td>
      <td><a href="#20">設定 /etc/named.conf</a></td>
    </tr>
    <tr> 
      <td><font color="#000099">&nbsp;</font></td>
      <td align="center" valign="top" nowrap><font color="#000099">12.5.2</font></td>
      <td><a href="#21">建立正解區域檔案</a></td>
    </tr>
    <tr> 
      <td><font color="#000099">&nbsp;</font></td>
      <td align="center" valign="top" nowrap><font color="#000099">12.5.3</font></td>
      <td><a href="#22">建立反解區域檔案</a></td>
    </tr>
    <tr> 
      <td><font color="#000099">&nbsp;</font></td>
      <td align="center" valign="top" nowrap><font color="#000099">12.5.4</font></td>
      <td><a href="#23">測試 DNS</a></td>
    </tr>
    <tr> 
      <td><font color="#000099">&nbsp;</font></td>
      <td align="center" valign="top" nowrap><font color="#000099">12.5.5</font></td>
      <td><font color="#000099"><a href="#24">Client 端常用來做名稱查詢的工具</a> ---<br>
        <a href="#25">nslookup</a> 、<a href="#26">dig</a>、<a href="#27">host</a></font></td>
    </tr>
    <tr> 
      <td colspan="3"><font color="#000099"><strong>12.6 <a href="#28">設定 Slave 
        DNS</a></strong></font></td>
    </tr>
    <tr> 
      <td><font color="#000099">&nbsp;</font></td>
      <td align="center" valign="top" nowrap><font color="#000099">12.6.1</font></td>
      <td><a href="#29">設定 Slave</a> <font color="#000099">--- <a href="#45">指定 
        zone file 位置問題</a></font></td>
    </tr>
    <tr> 
      <td><font color="#000099">&nbsp;</font></td>
      <td align="center" valign="top" nowrap><font color="#000099">12.6.2</font></td>
      <td><a href="#30">保持 Slave 與 Master 的資料同步</a></td>
    </tr>
    <tr> 
      <td colspan="3"><font color="#000099"><strong>12.7 <a href="#31">子網授權</a></strong></font></td>
    </tr>
    <tr> 
      <td><font color="#000099">&nbsp;</font></td>
      <td align="center" valign="top" nowrap><font color="#000099">12.7.1</font></td>
      <td><a href="#32">子網正解授權</a></td>
    </tr>
    <tr> 
      <td><font color="#000099">&nbsp;</font></td>
      <td align="center" valign="top" nowrap><font color="#000099">12.7.2</font></td>
      <td><a href="#33">子網反解授權</a></td>
    </tr>
    <tr> 
      <td colspan="3"><font color="#000099"><strong>12.8 <a href="#34">ACL 存取控制清單</a></strong></font></td>
    </tr>
    <tr> 
      <td colspan="3"><strong><font color="#000099">12.9 <a href="#35">Bind 9 
        所提供的 view 功能</a></font></strong></td>
    </tr>
  </table>
  <font size="+1"> </font> <br>
  <hr>
  <p><font size="+1"> </font> <font size="+1"><strong><font color="#0000FF"> <a name="1"></a><font size="6">12.1 
    DNS 的相關說明</font><br>
    <br>
    <font color="#000000"><a name="2"></a><font size="5">12.1.1 DNS 簡介</font></font></font></strong><br>
    <br>
    </font>　DNS 全<font size="3">名</font>為 Domain Name System，從字面上的意思大概可以看出是一個與名稱有關係的一個服務吧，的確也是如此。<br>
    <br>
    　 今天不管連上某網站如 <a href="javascript:if(confirm(%27http://www.sina.com.tw/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.sina.com.tw/%27" tppabs="http://www.sina.com.tw/" target="_blank">http://www.sina.com.tw/，</a>或登入各大學的 
    FTP 站台如 <a href="javascript:if(confirm(%27ftp://ftp.nsysu.edu.tw/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27ftp://ftp.nsysu.edu.tw/%27" tppabs="ftp://ftp.nsysu.edu.tw/" target="_blank">ftp://ftp.nsysu.edu.tw/</a>，其實不知不覺中就已經使用了 
    DNS 所提供的服務了，因為透過了 DNS 的解析，才能夠把 www.sina.com.tw 及 ftp.nsysu.edu.tw 這些名稱找到其所對應的 
    IP 位址，封包也才知道要往哪裡去。<br>
    <br>
    　當然如果事先知道目的地的 IP 位址，而直接輸入此 IP 來與對方連線不是更快嗎 ? 話是沒錯啦，但試問有幾個人會去記那些密密麻麻的數字呢 ? 除非您記憶力過人吧 
    !<br>
    <br>
    　接著再來談一下等等常會提到的一個名詞 <strong> FQDN</strong>，其全名為 Fully Qualified Domain Name，FQDN 
    是由 hostname 及 domain name 所組成的，以前面所舉的例子來說，www.sina.com.tw 就是一個 FQDN，其中 www 
    為 hostname，sina.com.tw 就是 domain name，又如 ftp.nsysu.edu.tw 中，ftp 是 hostname，nsysu.edu.tw 
    就是 domain name，這樣各位應該可以理解吧 !<br>
    <br>
    　由以上說明可以知道 DNS (Name Server) 的主要的功用就是將 FQDN 解析出其所對應的 IP 位址 (最終為二進位的 0 與 1)，這也是一般所謂的正解 
    (正向解析)。另外 DNS 還可以提供反解的查詢，也就是將 IP 位址解析出其所對應的 FQDN。至於反解使用的時機，比如說某些 Server 基於安全的考量，會對來源端的 
    IP 位址反查其所對應的 FQDN，然後再查此 FQDN 所對應的 IP 是否一致 ﹔又如在 tcp-wrapper 裡所設定的 KNOWN、UNKNOWN 
    也會用到反查 ﹔最後就是系統在做紀錄時，也會將來源位址做反解，這樣好讓紀錄檔內能顯示來源端主機名稱的資訊。<br>
    <font size="+1"> </font><font size="+1"> </font><font size="+1"> </font><font size="+1"> 
    </font><font size="+1"> </font><font size="+1"> </font><font size="+1"> </font><font size="+1"> 
    </font><font size="+1"> </font><font size="+1"> </font><font size="+1"> </font><font size="+1"> 
    </font><font size="+1"> </font><font size="+1"> </font><font size="+1"> </font><font size="+1"> 
    </font><font size="+1"> </font><font size="+1"> </font><font size="+1"> </font><font size="+1"> 
    </font><font size="+1"> </font><font size="+1"> </font><font size="+1"> </font><font size="+1"> 
    </font><font size="+1"> </font><font size="+1"> </font><font size="+1"> </font><font size="+1"> 
    </font><font size="+1"> </font><font size="+1"> </font><font size="+1"> </font><font size="+1"> 
    </font><br>
    <font size="+1"><strong><font color="#000000"><a name="3"></a><font size="5">12.1.2 
    DNS 的網域名稱空間 (domain name space)</font></font></strong><br>
    <br>
    </font>　DNS 為一層級式的分散式名稱對應系統，最上層為 root domain<font size="+1">，</font>以「. 」來表示，其下又分成好幾個組織類別的 
    domain<font size="+1">，</font>這些 domain 又繼續往下延伸<font size="+1">，</font>而形成如下的樹狀結構圖：</p>
  <p align="center"><font size="+1"> <img src="../picture/dns1.png" tppabs="http://www.suse.url.tw/picture/dns1.png" width="517" height="265"> 
    </font></p>
  <p align="left"> 　在 root domain 的下一層 domain，稱之為 <strong>TLD</strong> (Top Level 
    Domain)，而 TLD 主要區分成兩種：</p>
  <table width="100%" border="0">
    <tr> 
      <td width="3%" align="center" valign="top" nowrap>&nbsp;</td>
      <td width="3%" align="center" valign="middle" nowrap><img src="../picture/icon.jpg" tppabs="http://www.suse.url.tw/picture/icon.jpg" width="11" height="11"></td>
      <td width="94%"><strong><font color="#000099">gTLD</font></strong> <font color="#000099"><strong>( 
        generic TLD )</strong>：</font></td>
    </tr>
    <tr> 
      <td align="center" valign="top" nowrap>&nbsp;</td>
      <td align="center" valign="middle" nowrap>&nbsp;</td>
      <td>非以國碼為命名的一般 TLD 稱之。如 com (公司行號)、org (非營利的組織單位)、net (網路單位)、edu (教育單位)、gov 
        (政府單位)、mil (軍事單位)、int (國際性的機構)等。</td>
    </tr>
    <tr> 
      <td align="center" valign="top" nowrap>&nbsp;</td>
      <td align="center" valign="middle" nowrap><img src="../picture/icon.jpg" tppabs="http://www.suse.url.tw/picture/icon.jpg" width="11" height="11"></td>
      <td><strong><font color="#000099">ccTLD</font></strong> <font color="#000099"><strong>( 
        country code TLD )</strong>：</font></td>
    </tr>
    <tr> 
      <td align="center" valign="top" nowrap>&nbsp;</td>
      <td align="center" valign="middle" nowrap>&nbsp;</td>
      <td>以國碼為命名的 TLD 稱之。如 tw (台灣 )、cn (中國大陸 )、jp ( 日本 )、hk ( 香港 )、&#8230; 等等。<br>
        由於 internet 最早是美國所開始發展的，所以在初期並沒有這些以國碼來命名的 ccTLD，不過後來隨著 internet 的日漸熱絡，才又加入了這些 
        ccTLD。</td>
    </tr>
  </table>
  <br>
  　另外還有個比較特殊的 TLD 叫 arpa，它是沿用 ARPAnet (美國官方的電腦網路，為 Internet 的前身) 的名稱而來，現在則提供做 
  DNS 反解的用途。<br>
  <br>
  　接著在 TLD 之下的 domain 稱為 <strong>SLD</strong> (Second Level Domain)。以 tw 來說，其下的 
  SLD 有 org、com、net、edu、idv、mil、gov 等等。再往下的話，就是一些機構組織或個人所申請的 domain，比如中山大學的 nsysu.edu.tw，新浪網的 
  sina.com.tw，那如果是個人網域的話則為 xxx.idv.tw 之類的。至於最後一層就是您 domain 裡頭的主機名稱了，當然也有可能再繼續往下延伸出其他的 
  sub-domain，這就看您如何規劃囉 !<br>
  <br>
</div>
<font size="+1"> <font size="+1"><font color="#0000FF"><strong><a name="4"></a></strong></font></font><font color="#0000FF" size="6"><strong>12.2 
DNS 的查詢流程</strong></font><br>
<br>
<strong><a name="5"></a><font size="5">12.2.1 與名稱查詢有關的檔案</font></strong></font><br>
<br>
　在還沒開始詳細介紹 DNS 查詢流程之前，先來認識幾個與 DNS Client 端做名稱查詢時有關的檔案：<br>
<br>
<font size="+1"><strong><a name="6"></a><font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"></font> 
檔案 /etc/hosts</strong><br>
<br>
　</font>這個檔案是用來提供給<strong>本機做名稱解析</strong>用的，其設定格式如下：<font size="+1"><br>
<br>
</font> 
<table width="100%" border="0" bgcolor="#000000">
  <tr> 
    <td><font color="#0099FF"><strong><font face="細明體">#IP-Address 　　Full-Qualified-Hostname　Short-Hostname</font></strong></font><font face="細明體"><br>
      </font><font color="#FFFFFF" face="細明體">127.0.0.1　　　　　 localhost</font><font face="細明體"><br>
      </font><font color="#FFFFFF" face="細明體">192.168.1.120</font><font color="#FFFFFF"><font face="細明體">　　　</font></font><font color="#FFFFFF" face="細明體"> 
      suse.test.com.tw　　　　　　suse</font> <font face="細明體"><br>
      </font><font color="#FFFFFF" face="細明體">192.168.1.130　　　 linux.test.com.tw　　　　　 
      linux</font> </td>
  </tr>
</table>
<font size="+1"><br>
</font><strong>　</strong>您可以把主機名稱所對應的 IP 位址設定在這裡，以提供本機做名稱解析的用途。以上面這個範例來說，假使 192.168.1.120 
這部主機是一台 Web Server，則當 Client 所輸入的 URL 為 http://suse.test.com.tw/ 或 http://suse/ 
時，就可以連上 192.168.1.120 這部主機。所以藉由指定這個檔案所設定的完整主機名稱或簡短的主機別名，便可輕鬆的查詢到其所對應的 IP 位址。<br>
<br>
　早期在小型網路中沒架設 DNS 時，即是利用 /etc/hosts 檔，來提供名稱解析的用途。不過在主機數量少的時候還好搞定，但如果是處在一個大型網路，且主機數量非常多時，使用這種方式就會顯得非常麻煩，因為您需要在每一台主機的 
hosts 檔中去設定其他主機的紀錄。此時要解決這個問題的最好方式，就是架設 DNS 了。<font size="+1"><br>
<br>
</font> <font size="+1"><strong><a name="7"></a><font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"></font> 
檔案 /etc/resolv.conf<br>
<br>
</strong>　</font>這個檔案主要是設定 client 端所指定要使用的預設名稱伺服器的位址，其設定範例如下：<strong></strong><font size="+1"><strong><br>
<br>
</strong></font> 
<table width="50%" border="0">
  <tr> 
    <td height="72" bgcolor="#000000"><font color="#FFFFFF" face="細明體">nameserver 
      168.95.1.1<br>
      nameserver 168.95.192.2<br>
      search domain.com.tw test.com.tw<br>
      domain paching.com.tw</font></td>
  </tr>
</table>
<strong><br>
　nameserver</strong> 是用來指定 client 端預設要使用的 DNS 位址，也就是說打算想向哪台 DNS 做查詢的意思啦。您最多只能設定三筆 
nameserver 紀錄，且會依照您所設定的順序依序做查詢。當在做名稱查詢時，會先向第一台 DNS 詢問，若得不到回應則轉而向第二台查詢，如還是沒有回應，則向第三台查詢。<br>
<br>
　<strong>search</strong> 的功用是當我們要查詢的名稱不是 FQDN，而是一個不包含 &quot; . &quot; 的 Short-Hostname 
時，則會先在這個 Short-Hostname 後面補上 search 所指定的 domain name，然後才向 DNS 查詢。比如所要查詢的是 testhost 
時，則會先向 DNS 查詢 testhost.domain.com.tw，若查不到再向 DNS 查詢 testhost.test.com.tw，如果還是查不到，那就宣告查詢失敗囉。<br>
<br>
　至於最後面的 <strong>domain</strong>，則只是用來設定主機所在的網域而已。<br>
<br>
　一般來說，search 及 domain 的設定可有可無，主要的還是那個 nameserver 啦。<font size="+1"><strong><br>
</strong></font><font size="+1"><strong><br>
<a name="8"></a><font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"></font> 
檔案 /etc/nsswitch.conf</strong><br>
<br>
　</font>可用來決定名稱查詢順序的一個檔案。設定範例如下：<font size="+1"><font size="+1"><br>
<br>
</font> </font> 
<table width="50%" border="0">
  <tr> 
    <td height="25" bgcolor="#000000"><font color="#FFFFFF" face="細明體">hosts : 
      files dns</font></td>
  </tr>
</table>
<strong><br>
　</strong>設定主機名稱查詢的順序，是先根據 files (就是 /etc/hosts) 做查詢，如果查詢失敗再向 dns (在 /etc/resolv.conf 
中所指定的 DNS 位址) 做查詢。假使您要把這個查詢順序顛倒過來的話，那就把 dns 跟 files 的位置對調即可。<font size="+1"><br>
</font><br>
<font color="#000000" size="+1"><strong><a name="9"></a><font size="5">12.2.2 
DNS 查詢流程</font></strong></font><br>
<br>
　這邊就要詳細介紹整個查詢流程囉。<br>
<br>
<strong><a name="10"></a><font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"> 
正解查詢</font></strong><br>
<p>　以 client 端查詢 www.google.com 為例，來說明整個名稱查詢的過程。<br>
  <br>
  　假設 linux 的 client 端，其 /etc/nsswitch.conf 所設定的主機名稱查詢順序為先 files 再 dns，且其 /etc/resolv.conf 
  內所指定的 Name Server (NS) 為下圖所顯示的 Local DNS，則當 client 端在查詢 www.google.com 時，會先查本機的 
  /etc/hosts 檔，查不到才會向 Local DNS 做查詢。而接著下來的說明，就是從 client 向 Local DNS 提出查詢開始，來講解整個詳細的過程：</p>
<p align="center"> <img src="../picture/dns2.png" tppabs="http://www.suse.url.tw/picture/dns2.png" width="598" height="254" border="2"> 
  <br>
  <font size="2">名稱查詢流程圖</font></p>
<ol>
  <li>client 向 Local DNS 查詢 www.google.com 的位址，如果該項詢問是屬於本網域內的查詢，則直接做出回應 (此回答一般就稱之為授權回答 
    : Authoritative Answer)，否則就看看 cache 裡頭有沒有該筆記錄，如果還是沒有的話，則只好從最上層 root domain 
    的 DNS 查詢起囉。<font size="2"><br>
    </font></li>
  <li>Local DNS 向 root domain 裡的其中一台 DNS (root name server) 查詢 www.google.com 
    的位址。 <br>
  </li>
  <li>此時 root name server 只會提供其所管轄區域 (root domain) 裡的主機資訊做出回應，那這時候當然就是把 root domain 
    的下一層 --- com domain 的授權 (authoritative) DNS 主機位址告知 Local DNS，同時 Local DNS 
    會把此紀錄存放在 cache 內。 <br>
  </li>
  <li>Local DNS 既然已經知道了 com domain 的 DNS 位址，就直接向它查詢 www.google.com 的位址。<br>
  </li>
  <li>com domain 的 DNS 一樣只提供其所負責 com 網域內的主機紀錄，所以就會把 google.com domain 的授權 DNS 
    主機位址告知 Local DNS，然後 Local DNS 再把此紀錄存放在 cache 內。 <br>
  </li>
  <li>Local DNS 向 google.com domain 的 DNS 查詢 www.google.com 的位址。 <br>
  </li>
  <li>google.com 的 DNS 從其資料庫中找出 www.google.com 的位址，並回應給 Local DNS。 <br>
  </li>
  <li>Local DNS 把所查詢而來的 www.google.com 位址存放在 cache 內，並回應給 DNS client 端。</li>
</ol>
　由以上的查詢過程，不難看出 DNS 分層負責的型態。在 domain 底下可以再細分出一些 sub-domain，而上層的 DNS 可以授權給一台以上的 
DNS 去管理其下 sub-domain 內的主機名稱記錄，同樣的道理，這些 sub-domain 也可以再分出其他的 sub-domain，然後再授權給一台以上的 
DNS 去管理，所以每一層 domain 的 DNS 就只負責這個 domain 內的主機名稱解析工作就行了。<br>
<br>
　另外 Local DNS 會將所有查詢到的結果，暫時存放在 cache 內，這樣下一次在接受同一筆紀錄的查詢時，可以直接從 cache 裡做出回應，而不需再從 
root name server 查詢起，大大的縮短了查詢的時間。至於存放在 cache 內的紀錄可以保留多久，則要看對方 DNS 的 TTL 設定為何了，這部分等介紹 
DNS 的設定檔時會再說明。<br>
<br>
<strong><a name="11"></a><font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"> 
反解查詢</font></strong><br>
<br>
　如果是要反查 IP 位址所對應的 FQDN，其流程跟正解差不多。以最前面的那張 [ DNS 樹狀結構圖 ] 來說，當您要反查的是 220.132.78.75 
時，Local DNS 會先檢查是否為本網段的查詢，不是的話，再檢查 cache 裡頭有無這筆記錄，如果還是沒有的話，就直接向 root name server 
查詢起，然後逐層往下詢問：root → arpa → in-addr → 220 → 132 → 78，因此最後會向管理 220.132.78 這個 IP 
網段的 DNS 來查詢，從而查到了 220.132.78.75 所對應的主機名稱。<br>
<br>
<font size="+1"><strong><a name="12"></a><font size="5">12.2.3 DNS 的查詢模式</font></strong></font><br>
<strong><font color="#0000FF" size="+1"> <br>
</font></strong><font color="#000000">　了解了查詢流程之後，以下的 dns 查詢模式就很好理解了：</font><font color="#0000FF" size="+1"><strong><br>
<br>
</strong></font> 
<table width="100%" border="0">
  <tr> 
    <td width="2%" align="center" valign="top">&nbsp;</td>
    <td width="3%" align="center" valign="middle"><img src="../picture/icon.jpg" tppabs="http://www.suse.url.tw/picture/icon.jpg" width="11" height="11"></td>
    <td width="95%"><strong><font color="#000099">遞回查詢</font></strong><font color="#000099"> 
      ( Recursive )：</font></td>
  </tr>
  <tr> 
    <td align="center" valign="top">&nbsp;</td>
    <td align="center" valign="middle">&nbsp;</td>
    <td>當 DNS client 向 Local DNS 提出查詢時，若 Local DNS 本身查無該筆記錄，轉而向其他的 DNS 詢問，然後再把最後所查得的結果回應給 
      DNS client，這樣的一個查詢模式就叫做遞回查詢。由此可知， DNS Client 與 Local DNS 之間便是採用這種查詢模式。</td>
  </tr>
  <tr> 
    <td align="center" valign="top">&nbsp;</td>
    <td align="center" valign="middle"><img src="../picture/icon.jpg" tppabs="http://www.suse.url.tw/picture/icon.jpg" width="11" height="11"></td>
    <td><strong><font color="#000099">反覆查詢</font></strong><font color="#000099"> 
      ( Iterative )：</font></td>
  </tr>
  <tr> 
    <td align="center" valign="top">&nbsp;</td>
    <td align="center" valign="middle">&nbsp;</td>
    <td>當 Local DNS 在向其他 DNS 查詢時，只得到對方 DNS 所管理網域內的主機紀錄，並無法獲得進一步的遞回查詢，這樣稱之為反覆查詢。比如在剛剛介紹的查詢流程裡，Local 
      DNS 向 root DNS 查詢 www.google.com 時，root DNS 並不會幫 Local DNS 去查詢 www.google.com 
      的最終位址，而只是回應負責 com domain 的 DNS 位址而已，那麼這個 Local DNS 與 root DNS 之間的查詢，就是屬於這種反覆查詢的模式。一般 
      DNS 之間的查詢皆屬之。</td>
  </tr>
</table>
<font color="#0000FF" size="+1"></font> 
<p> <strong><font color="#0000FF" size="+1"><br>
  </font></strong><font size="+1"><strong><font color="#0000FF"><a name="13"></a><font size="6">12.3 
  zone 的概念、網域申請<strong>及</strong></font></font></strong></font> <font size="6"><strong><font color="#0000FF">DNS 
  類別</font></strong></font> <br>
  <br>
  <font size="+1"><strong><a name="14"></a><font size="5">12.3.1 zone 與 domain 
  的區別</font><br>
  </strong></font><br>
  　這兩個名詞一般人容易搞混，我們直接以下圖的&nbsp;DNS 樹狀結構圖來說明：</p>
<p align="center"> <img src="../picture/dns3.png" tppabs="http://www.suse.url.tw/picture/dns3.png" width="329" height="285" border="1"></p>
<p> 　在 edu.tw 之下，稱為 edu.tw domain，在 nsysu.edu.tw 之下，稱為 nsysu.edu.tw domain ，同時它也是屬於 
  edu.tw domain。而 nsysu.edu.tw 就可以說是 edu.tw 底下的其中一個 sub-domain，也就是一般所謂的 zone 啦。<br>
  <br>
  　zone 可以是由 NIC ( Network Information Center ) 或者有被 NIC 授權的代理機構所申請回來的 Domain 
  Name，也可以是該 domain 下的 sub-domain。而當您要自己管理區域 (zone) 內的主機名稱對應紀錄時，就必須要架設 DNS。比如上圖中 
  ns.nsysu.edu.tw 這台 DNS，就是用來管理 nsysu.edu.tw 這個&nbsp;zone 裡的主機紀錄，因此在這台 DNS 主機上頭，就必需要有一個關於 
  nsysu.edu.tw 這個 zone 的資料庫檔案 (zone file)，檔案中需存在 www 及 ftp 這兩台主機的紀錄，這樣 internet 
  上的其他 DNS 或者 DNS client，才能夠查詢到這兩台主機的位址。<br>
  <br>
  　 <br>
  <font size="+1"><strong><a name="15"></a><font size="5">12.3.2 網域名稱的申請</font><br>
  </strong></font><br>
  　要架設一個能對外提供服務的 DNS 之前，當然就要先申請一個網域名稱囉，您可以到 <a href="javascript:if(confirm(%27http://www.twnic.net.tw/index4.php  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.twnic.net.tw/index4.php%27" tppabs="http://www.twnic.net.tw/index4.php" target="_blank">TWNIC</a> 
  (台灣網路資訊中心) 所授權的受理註冊機構來提出申請，比如<a href="javascript:if(confirm(%27http://rs.apol.com.tw/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://rs.apol.com.tw/%27" tppabs="http://rs.apol.com.tw/" target="_blank"> 
  rs.apol.com.tw</a> (亞太線上)、<a href="javascript:if(confirm(%27http://nweb.hinet.net/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://nweb.hinet.net/%27" tppabs="http://nweb.hinet.net/" target="_blank">nweb.hinet.net</a> 
  (中華電信)、<a href="javascript:if(confirm(%27http://rs.seed.net.tw/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://rs.seed.net.tw/%27" tppabs="http://rs.seed.net.tw/" target="_blank"> rs.seed.net.tw</a> (數位聯合)、<a href="javascript:if(confirm(%27http://tw.domain.yahoo.com/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://tw.domain.yahoo.com/%27" tppabs="http://tw.domain.yahoo.com/" target="_blank">tw.domain.yahoo.com</a> 
  (雅虎國際)、&#8230; 等等。<br>
  <br>
  　筆者以在 hinet 申請個人網域的流程做個簡單介紹。首先連上 nweb.hinet.net 首頁，並輸入您要申請的 domain name：</p>
<p align="center"> <img src="../picture/dns4.png" tppabs="http://www.suse.url.tw/picture/dns4.png" width="753" height="485"><br>
  <font size="2">圖一：網域註冊主畫面</font></p>
<p> 　如該 domain 名稱尚未被註冊掉，則會看到以下的訊息，否則就需再選擇其他的網域名稱：</p>
<p align="center"> <img src="../picture/dns5.png" tppabs="http://www.suse.url.tw/picture/dns5.png" width="527" height="457" border="2"><br>
  <font size="2">圖二：網域名稱申請同意書畫面</font></p>
<p> 　接著會要求您輸入個人資料：</p>
<p align="center"> <img src="../picture/dns6.png" tppabs="http://www.suse.url.tw/picture/dns6.png" width="506" height="432" border="1"><br>
  <font size="2">圖三：填寫個人資料畫面</font></p>
<p> 　完成後就可以看到以下訊息，這些內容應該看得懂吧。</p>
<p align="center"> <img src="../picture/dns7.png" tppabs="http://www.suse.url.tw/picture/dns7.png" width="512" height="327" border="1"><br>
  <font size="2">圖四：網域註冊完畢後的相關注意事項提示畫面</font></p>
<p> <strong><a name="16"></a><font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"></font> 
  <font size="4">完成正解授權 (Delegation)</font></strong><font size="4"><br>
  </font><br>
  　當您想自行架設 DNS 來管理網域內的主機名稱對應紀錄時，則上層 DNS 必需先授權給您的 DNS 來管理才行，在任何未經合法授權而私自架設的 DNS，是無法提供給 
  internet 來查詢的。想讓上層的 DNS 授權給你，則在剛剛所申請的網域下來後， 請到首頁畫面點選 [DNS 異動與查詢]，然後輸入您的 domain 
  name 與判別密碼：</p>
<p align="center"> <img src="../picture/dns8.png" tppabs="http://www.suse.url.tw/picture/dns8.png" width="692" height="352" border="1"><br>
  <font size="2">圖五：DNS異動與查詢畫面</font></p>
<p> 　接著請在指定型態處選擇 [DNS]，並輸入您 DNS 伺服器的主機名稱與 IP 位址 ：</p>
<p align="center"> <img src="../picture/dns9.png" tppabs="http://www.suse.url.tw/picture/dns9.png" width="559" height="305"><br>
  <font size="2">圖六：指定DNS的設定畫面</font></p>
<blockquote>
  <p><font color="#000099"><strong>Tips</strong>：</font><font color="#000099" size="2">如您申請的不是個人網域，可能會要求您輸入兩筆 
    DNS 的主機資料，此時如您只有一台 dns，則可將兩個主機名稱都指向同一個 IP。</font></p>
</blockquote>
<p>　這是指定完成後的提示訊息：</p>
<p align="center"> <img src="../picture/dns10.png" tppabs="http://www.suse.url.tw/picture/dns10.png" width="370" height="173" border="0"><br>
  <font size="2">圖七：異動完成後的提示畫面</font></p>
<p> 　等 DNS 生效後，就完成上層 DNS 的授權動作了。其實這個授權只是在上層的 DNS 資料庫裡增加一筆 paching.idv.tw 的 NS 
  (Name Server) 紀錄，並使用 A (Address) 紀錄來指出此 Name Server 的 IP 位址，這樣當有人要查詢 paching.idv.tw 
  網域內的主機時，才有辦法向您這部 DNS 做查詢。<br>
  <br>
  <font size="+1"><strong><a name="17"></a><font size="5">12.3.3 DNS 的類別</font></strong></font><br>
  <br>
  　常看到的 DNS Server 類型有以下幾種：</p>
<table width="100%" border="0">
  <tr> 
    <td width="2%" align="center" valign="top">&nbsp;</td>
    <td width="2%" align="center" valign="top"><img src="../picture/icon.jpg" tppabs="http://www.suse.url.tw/picture/icon.jpg" width="11" height="11"></td>
    <td width="96%"><strong><font color="#000099">Master DNS Server</font></strong><font color="#000099"> 
      ：</font><br>
      Master DNS 為主要名稱伺服器，在這部主機上，必須存在著所負責 domain 的資料庫檔案。我們可以擁有一台以上的 Master，但麻煩的是在更新資料時，需於每一台 
      Master 做修改，如此一來，容易產生資料不同步的情形，所以 Master 最好還是只有一台。</td>
  </tr>
  <tr> 
    <td align="center" valign="top">&nbsp;</td>
    <td align="center" valign="top"><img src="../picture/icon.jpg" tppabs="http://www.suse.url.tw/picture/icon.jpg" width="11" height="11"></td>
    <td><strong><font color="#000099">Slave DNS Server</font></strong><font color="#000099">：</font><br>
      Slave DNS 裡，也有 domain 的資料庫檔案，不過裡頭的資料紀錄是從 Master 所傳送過來的 (zone transfer)，因此您不需在 
      Slave DNS 上去設定或修改這些資料庫檔案。至於為何要有 Slave 呢 ? 舉例來說，假使您只有一台 Master DNS 時，萬一這台 
      DNS 掛了，那就無法對外提供任何查詢了，所以有台 Slave 還是比較保險 ﹔再來要是平常 Master DNS 的負擔很重，則可藉由 Slave 
      來分擔 Master 的工作。所以要不要架設 Slave，就看您自己的評估了。</td>
  </tr>
  <tr> 
    <td align="center" valign="top">&nbsp;</td>
    <td align="center" valign="top"><img src="../picture/icon.jpg" tppabs="http://www.suse.url.tw/picture/icon.jpg" width="11" height="11"></td>
    <td><strong><font color="#000099">Cache-only Server</font></strong><font color="#000099">：</font><br>
      這類型的 DNS，本身並不提供 domain 的資料庫，因此當 client 向其提出查詢時，如 cache 裡無該筆紀錄，就會轉而向其他 DNS 
      詢問，並將所查得的資料紀錄也儲存一份到 cache 內。而 client 從 Cache-only DNS 所得到的回應，都是屬於未授權回答 (<strong>Non- 
      authoritative Answer</strong>)。</td>
  </tr>
</table>
<br>
<strong><font color="#0000FF" size="+1"><a name="18"></a><font size="6">12.4 </font></font></strong><font size="6"><strong><font color="#0000FF">安裝 
DNS 所需套件</font></strong></font><font size="+1"><br>
<br>
</font> 　DNS 所使用最著名的一套軟體叫做 BIND，而 BIND 全名為 Berkeley Internet Name Domain，是由柏克萊大學所研發，目前由 
ISC (Internet Systems Consortium) 組織負責維護與發展。 <br>
<br>
　BIND 主要區分 4.x 版及 8.x 版，目前則是 9.x 版，您可至 ISC 網站查看目前最新版本為何：<a href="javascript:if(confirm(%27http://www.isc.org/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.isc.org/%27" tppabs="http://www.isc.org/" target="_blank">http://www.isc.org/</a><br>
<br>
<strong><font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"></font> 
<font size="4">DNS 相關套件</font></strong><br>
<br>
<table width="61%" border="1">
  <tr bgcolor="#CCCCCC"> 
    <td nowrap> <div align="center"><strong><font color="#000099">套件名稱</font></strong></div></td>
    <td nowrap> <div align="center"><strong><font color="#000099">簡　單　描　述</font></strong></div></td>
  </tr>
  <tr> 
    <td width="15%" nowrap> <div align="center"><font color="#000099">bind</font></div></td>
    <td width="85%" nowrap><font color="#FFFFFF"><font color="#000099">DNS 的主要套件。</font></font></td>
  </tr>
  <tr> 
    <td nowrap> <div align="center"><font color="#000099">bind-chrootenv</font></div></td>
    <td nowrap><font color="#000099">使用 chroot 機制時，所需安裝之套件。此亦為 bind 的相依套件。</font></td>
  </tr>
  <tr> 
    <td nowrap> <div align="center"><font color="#000099">bind-utils</font></div></td>
    <td nowrap><font color="#FFFFFF"><font color="#000099">DNS Client 做名稱查詢時，所使用的工具都在這個套件內。</font></font></td>
  </tr>
</table>
<br>
<strong><font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"></font> 
<font size="4">查詢套件內容</font></strong><br>
<br>
<table width="100%" border="0">
  <tr> 
    <td nowrap bgcolor="#000000"><font color="#FFFFFF">suse:~ #<font color="#FFFF00"><strong> 
      rpm -ql bind</strong></font><br>
      </font> <table width="100%" border="0">
        <tr> 
          <td width="22%" align="left" valign="top" nowrap><font color="#FFFFFF">/etc/init.d/named</font></td>
          <td width="78%"><font color="#00FFFF" size="2">→ 管理 DNS 服務的 script。</font></td>
        </tr>
        <tr> 
          <td align="left" valign="top" nowrap><font color="#FFFFFF">/etc/named.conf</font></td>
          <td><font color="#00FFFF" size="2">→ DNS 的主要設定檔。</font></td>
        </tr>
        <tr> 
          <td align="left" valign="top" nowrap><font color="#FFFFFF">/usr/sbin/named 
            </font></td>
          <td><font color="#00FFFF" size="2">→ 提供 DNS 服務的 daemon。</font></td>
        </tr>
        <tr> 
          <td align="left" valign="top" nowrap><font color="#FFFFFF">/usr/sbin/rcnamed</font></td>
          <td><font color="#00FFFF" size="2">→ 本身為一符號連結檔，連結至 /etc/init.d/named。</font></td>
        </tr>
        <tr> 
          <td align="left" valign="top" nowrap><font color="#FFFFFF">/var/lib/named/127.0.0.zone</font></td>
          <td><font color="#00FFFF" size="2">→ 提供本機反解的 zone file。</font></td>
        </tr>
        <tr> 
          <td align="left" valign="top" nowrap><font color="#FFFFFF">/var/lib/named/localhost.zone</font></td>
          <td><font color="#00FFFF" size="2">→ 提供本機正解的 zone file。</font></td>
        </tr>
        <tr> 
          <td align="left" valign="top" nowrap><font color="#FFFFFF">/var/lib/named/master 
            </font></td>
          <td><font color="#00FFFF" size="2">→ 此目錄可提供 Master DNS 安置正反解的 zone file。</font></td>
        </tr>
        <tr> 
          <td align="left" valign="top" nowrap><font color="#FFFFFF">/var/lib/named/root.hint</font></td>
          <td><font color="#00FFFF" size="2">→ 記載著 13 台 root name server 的位址。</font></td>
        </tr>
        <tr> 
          <td align="left" valign="top" nowrap><font color="#FFFFFF">/var/lib/named/slave 
            </font></td>
          <td><font color="#00FFFF" size="2">→ 此目錄可提供 Slave DNS 安置正反解的 zone file。</font></td>
        </tr>
      </table>
      <font color="#FFFFFF"><br>
      suse:~ #<font color="#FFFF00"><strong> rpm -ql bind-chrootenv<br>
      </strong></font></font> <table width="100%" border="0">
        <tr> 
          <td width="25%"><font color="#FFFFFF">/var/lib/named</font></td>
          <td width="75%"><font color="#00FFFF" size="2">→ 當啟用 chroot 機制時，daemon 
            所參考的根目錄位置。</font></td>
        </tr>
        <tr> 
          <td><font color="#FFFFFF">/var/lib/named/etc</font></td>
          <td><font color="#00FFFF" size="2">→ 當啟用 chroot 機制時，daemon 會到這個目錄下讀取設定檔。</font></td>
        </tr>
        <tr> 
          <td><font color="#FFFFFF">/var/lib/named/var/lib/named</font></td>
          <td><font color="#00FFFF" size="2">→ 當啟用 chroot 機制時，daemon 會到這個目錄中載入相關 
            zone file。</font></td>
        </tr>
      </table>
      <font color="#FFFFFF"><strong><font color="#FFFF00"><br>
      </font></strong> suse:~ #<font color="#FFFF00"><strong> rpm -ql bind-utils 
      <br>
      </strong><font color="#FFFFFF">/usr/bin/dig<br>
      /usr/bin/host<br>
      /usr/bin/nslookup <br>
      <font color="#00FFFF"># </font><font color="#00FFFF" size="2">以上三個指令，是提供給 
      client 端做名稱查詢的工具。</font></font></font></font></td>
  </tr>
</table>
<br>
<strong><font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"></font> 
<font size="4">設定開機時啟動 named 服務</font></strong><br>
<br>
<table width="100%" border="0" bordercolor="#FFFFFF">
  <tr> 
    <td height="27" bgcolor="#000000"><font color="#FFFFFF">suse:~ #<font color="#FFFF00"> 
      <strong>chkconfig named 35</strong></font></font></td>
  </tr>
</table>
<br>
<br>
<font color="#0000FF" size="+1"><strong><a name="19"></a><font size="6">12.5</font></strong></font> 
<font color="#0000FF" size="6"><strong>設定 DNS Server</strong></font><br>
<br>
<strong>　</strong>架設 DNS 時，/etc/named.conf<strong> </strong>是首先要去設定的檔案，裡頭主要是宣告您所要管理的 
zone (正解區域或反解區域) 為何，而這些 zone 裡的相關資料 (FQDN 或 IP 的對應關係) 要存放在哪個資料庫檔案 (zone file) 
中。等搞定了這個檔案後，接下來則要到<strong> </strong>/var/lib/named<strong> </strong>目錄下去設定這些 zone 
file。所以 /etc/named.conf 及 /var/lib/named/* 就是待會兒要去做設定的兩個地方。<br>
<br>
　不過 SuSE 裡頭對於 named 採用了 chroot (change root directory) 的機制。<strong>chroot 的主要作用就是改變程式執行時所參考的根目錄位置</strong>，比如以 
SuSE 來說， named 程式所參考的根目錄為 /var/lib/named，也就是 named 程式所要讀取的檔案都應該要存在於 /var/lib/named 
當中才行，因此當啟用 chroot 時， DNS 的設定檔及資料庫檔案所存放的位置就變成了 /var/lib/named/etc/named.conf 及 
/var/lib/named/var/lib/named/*。<br>
<br>
　哇，怎麼那麼麻煩，啟用 chroot 後所要設定的檔案路徑那麼長，真是麻煩，那乾脆把它給關了不就行了嗎 ? 但要怎麼關呢 ? 在 /etc/sysconfig/named 
檔案裡做修改啦： <br>
<br>
<table width="100%" border="0">
  <tr> 
    <td height="153" bgcolor="#000000"> <p><font color="#FFFFFF">suse:~ # <font color="#FFFF00"><strong>vi 
        /etc/sysconfig/named</strong></font><br>
        <br>
        <font color="#0099FF"># Shall the DNS server 'named' run in the chroot 
        jail /var/lib/named/?<br>
        #<br>
        # Each time you start one of the daemons with the init script,<br>
        # /etc/named.conf,/etc/named.conf.include, /etc/rndc.key,<br>
        # and all files listed in NAMED_CONF_INCLUDE_FILES<br>
        # will be copied relative to /var/lib/named/.<br>
        </font><br>
        <strong>NAMED_RUN_CHROOTED=&quot;yes&quot; </strong>　<font color="#00FFFF" size="2"><br>
        </font><font color="#00FFFF"># </font><font color="#00FFFF" size="2">由 
        yes 改成 no 以後，就停用 chroot 了。</font></font></p></td>
  </tr>
</table>
<br>
　不過建議不要改啦，因為採用 chroot 的目的，就是為了要加強系統安全啊，想想看萬一程式具有安全上的漏洞而遭人入侵時，充其量也只能在 /var/lib/named 
這個根目錄下搞破壞，這樣就大大的降低了對整體系統的危害。<br>
<br>
　另外您也不必擔心啟用 chroot 後，需要到剛剛所提及的那些地方去做設定，因為 SuSE 為了讓使用者在設定 DNS 時方便操作，所以做了一個很貼心的設計。請仔細看一下上面那個檔案的註解說明，其意思是說，當您每次啟動 
named 服務時，會自動幫您把 /etc/named.conf、/etc/named.conf.include、 /etc/rndc.key 及所有列在 
NAMED_CONF_INCLUDE_FILES 參數中的所有檔案，複製到 /var/lib/named/ 相對的目錄中。<br>
<br>
　再來觀察一個目錄的長格式：<br>
<br>
<table width="100%" border="0">
  <tr> 
    <td height="44" bgcolor="#000000"><font color="#FFFFFF">suse:~ # <font color="#FFFF00"><strong>ls 
      -ld /var/lib/named/var/lib/named</strong></font><br>
      lrwxrwxrwx 1 root root 5 Jul 14 15:03<font color="#00FFFF"> /var/lib/named/var/lib/named</font> 
      -&gt; <font color="#0099FF">.. / ..</font></font></td>
  </tr>
</table>
<br>
<font color="#FFFFFF"><font color="#000000">　原來 /var/lib/named/var/lib/named 是連結到 
/var/lib/named。</font></font><br>
<br>
　看完了以上的說明，應該已經了解到不管您有沒有啟用 named 的 chroot 機制，都只需針對 /etc/named.conf 及 /var/lib/named/* 
去做設定即可，不曉得這樣您還會想把 chroot 給關了嗎 ?<br>
<br>
　以上的觀念都清楚之後，接著下來就開始來學習設定 DNS 囉 !<br>
<br>
<font size="+1"><strong><a name="20"></a><font size="5">12.5.1 設定 /etc/named.conf</font></strong></font><br>
<br>
　由於筆者之前已申請了一個合法的 domain name --- paching.idv.tw，並且上層 DNS 也已授權給 dns.paching.idv.tw 
這台主機來管理這個 domain，因此在 named.conf 裡就必須去宣告這個正解區域的存在。<br>
<br>
　另外關於反解的部分，則需先獲得您 ISP 的授權才可做設定 (正反解的授權機構不同噢)，否則設了也沒用。這裡就假設 ISP 已授權同樣這台 DNS 去管理 
220.132.78.0/24 這個網段的 IP 位址所對應的主機名稱紀錄，因此在 named.conf 裡，就必須去宣告這個反解區域的存在。<br>
<br>
　接著請參考以下的設定範例：<br>
<br>
<table width="100%" border="0">
  <tr> 
    <td nowrap bgcolor="#000000"><font color="#FFFFFF">suse:~ #<strong><font color="#FFFF00"> 
      vi /etc/named.conf</font></strong><br>
      <font color="#00FFFF" size="2">// 設定檔內的</font><font color="#00FFFF">「</font><font color="#00FFFF" size="2">// 
      </font><font color="#00FFFF">」</font><font color="#00FFFF" size="2">或</font><font color="#00FFFF">「</font><font color="#00FFFF" size="2">#</font><font color="#00FFFF">」</font><font color="#00FFFF" size="2">是註解符號，而夾在 
      /* 及 */ 之間的敘述也都是註解。</font><font color="#00FFFF"><br>
      <font size="2">// 另外每一個完整的宣告，都必須以</font><font color="#FFFFFF"><font color="#00FFFF">「</font></font><font size="2">;</font><font color="#00FFFF">」</font><font size="2">做結尾。</font></font><br>
      <br>
      <font face="細明體">options { <br>
      　　　　directory &quot;/var/lib/named&quot;; <br>
      　　　　notify no; <br>
      }; </font><br>
      <font color="#00FFFF"># </font> </font><font color="#00FFFF" size="2">options 
      { } 內為整體 (global) 的宣告。<br>
      </font><font color="#00FFFF">#</font> <font color="#00FFFF" size="2">首先使用<strong> 
      directory </strong>來指出區域檔案 (zone file) 需安置在 /var/lib/named 目錄中，<br>
      </font><font color="#00FFFF"># </font> <font color="#00FFFF" size="2">當然若啟用 
      chroot 時，則實際路徑為 /var/lib/named/var/lib/named 。<br>
      </font><font color="#00FFFF"># </font> <font color="#00FFFF" size="2">至於 
      &quot;<strong> </strong>notify no<strong> </strong>&quot; 是說當 Master 資料庫異動後並重新啟動 
      named 服務時，不會對<br>
      </font><font color="#00FFFF"># </font> <font color="#00FFFF" size="2">區域檔案內有 
      NS 紀錄的主機發出 notify 的通知訊號。</font><font color="#FFFFFF"><br>
      <br>
      <font face="細明體">zone &quot;.&quot; in {<br>
      　　　　type hint;<br>
      　　　　file &quot;root.hint&quot;;<br>
      }; </font><strong><br>
      </strong> </font><font color="#00FFFF">#</font> <font color="#00FFFF" size="2">&quot; 
      <strong>. </strong>&quot; 代表 root zone 之意 ; <strong>in </strong>表示區域類別 (Class) 
      為 internet 的意思。</font><br> <font color="#00FFFF"># </font><font color="#00FFFF" size="2">再來就是 
      { } 之中的設定。</font><br> <font color="#00FFFF"># </font><font color="#00FFFF" size="2">首先使用<strong> 
      type</strong> 來宣告根區域所使用的名稱伺服器類型為何，常見的名稱伺服器類型</font><br> <font color="#00FFFF"># 
      </font><font color="#00FFFF" size="2">有 master、slave、forward 等，而此處的 <strong>hint</strong> 
      則為根區域專用的名稱伺服器類型。<br>
      </font><font color="#00FFFF"># </font><font color="#00FFFF" size="2">最後是用<strong> 
      file </strong>來宣告根區域的資料庫檔案名稱為 root.hint，也就是說 root.hint<br>
      </font><font color="#00FFFF"># </font><font color="#00FFFF" size="2">必須存在於 
      /var/lib/named/ 目錄內。 </font><font color="#00FFFF"><br>
      # </font><font color="#00FFFF" size="2">在 root domain 裡的 13 部 root name 
      server 的位址，就是定義在 root.hint 裡，<br>
      </font><font color="#00FFFF"># </font><font color="#00FFFF" size="2">而當您啟動 
      named 服務時，即會載入這個檔案。</font><font color="#00FFFF"><br>
      <br>
      </font><font color="#FFFFFF"><font face="細明體">zone &quot;localhost&quot; 
      in {<br>
      　　　　type master;<br>
      　　　　file &quot;localhost.zone&quot;;<br>
      };</font><br>
      </font><font color="#00FFFF"># </font><font color="#00FFFF" size="2">宣告本機正解區域為 
      &quot;<strong>localhost</strong>&quot;，其所使用的名稱伺服器類型為 <strong>master</strong>，而 
      zone file </font><br> <font color="#00FFFF"># </font><font color="#00FFFF" size="2">為 
      <strong>localhost.zone</strong>，也是一樣需存在於 /var/lib/named 內。</font><font color="#FFFFFF"><br>
      <br>
      <font face="細明體">zone &quot;0.0.127.in-addr.arpa&quot; in {<br>
      　　　　type master;<br>
      　　　　file &quot;127.0.0.zone&quot;;<br>
      };</font><strong><br>
      </strong> </font><font color="#00FFFF">#</font> <font color="#00FFFF" size="2">宣告本機反解區域為 
      &quot;<strong>0.0.127.in-addr.arpa</strong>&quot; ，其所使用的名稱伺服器類型為<strong> 
      master</strong>，</font><font color="#00FFFF"><br>
      #</font> <font color="#00FFFF" size="2">資料庫</font><font color="#00FFFF" size="2">檔案名稱為 
      <strong>127.0.0.zone</strong>。</font><font color="#00FFFF">&nbsp;</font><font color="#00FFFF" size="2"><br>
      </font><font color="#00FFFF"> <br>
      #</font> <font color="#00FFFF" size="2">以上三個 zone，預設都已存在，且那三個 zone file 
      也都已幫您安置於 /var/lib/named 目錄<br>
      </font><font color="#00FFFF">#</font> <font color="#00FFFF" size="2"> 中了，因此您不需對其做任何的修改。如果就在此時您啟動了 
      DNS，那麼這就是一部 <br>
      </font><font color="#00FFFF">#</font> <font color="#00FFFF" size="2">Cache-only 
      Name Server 囉。 </font> <br> <br> <font color="#00FFFF">#</font> <font color="#00FFFF" size="2">而這裡主要設定的是接著要介紹的兩個 
      zone，分別是正解區域及反解區域。<br>
      </font><font color="#00FFFF">#</font> <font color="#00FFFF" size="2">正解區域就是上層 
      DNS 授權給這台 DNS 所管理的 domain name，也就是 paching.idv.tw。<br>
      </font><font color="#00FFFF">#</font> <font color="#00FFFF" size="2"> 反解區域就是 
      ISP 授權給這台 DNS 管理的 220.132.78.0/24 這個網路段，也就是<br>
      </font><font color="#00FFFF">#</font> <font color="#00FFFF" size="2"> 78.132.220.in-addr.arpa 
      這個 zone，至於為何是這個名稱，參考一下本章最前面<br>
      </font><font color="#00FFFF">#</font> <font color="#00FFFF" size="2"> [DNS 
      樹狀結構圖] 最右邊的反解部分，及 12.2.2 小節所提到的反解查詢說明，</font><font color="#FFFFFF" size="2"><br>
      </font><font color="#00FFFF">#</font> <font color="#00FFFF" size="2">然後再與正解部分做個比較，應該就能理解。比如：</font><font color="#FFFFFF" size="2">&nbsp; 
      <br>
      <br>
      </font><font color="#FFFFFF"><font color="#00FFFF">#</font> </font><font color="#00FFFF" size="2">正解查詢流程：<strong>root</strong> 
      →<strong> tw → idv → paching</strong> → {www、ftp、mail、ns、&#8230;}<br>
      </font><font color="#00FFFF">#</font><font color="#00FFFF" size="2"> 提供正解查詢的 
      DNS，即負責管理 paching.idv.tw 這個 zone 下的主機名稱對應紀錄。<br>
      <br>
      </font><font color="#00FFFF">#</font><font color="#00FFFF" size="2"> 反解查詢流程：<strong>root</strong> 
      → <strong>arpa → in-addr → 220 → 132 → 78</strong> → {0、1、2、&#8230;、255}<br>
      </font><font color="#00FFFF">#</font><font color="#00FFFF" size="2"> 提供反解查詢的 
      DNS，即負責管理 78.132.220.in-addr.arpa 這個 zone 下的 IP 位址<br>
      </font><font color="#00FFFF">#</font><font color="#00FFFF" size="2">&nbsp;對應紀錄。</font><font color="#FFFFFF"><strong><br>
      <br>
      </strong><font face="細明體">zone &quot;paching.idv.tw&quot; in {<br>
      　　　　type master;<br>
      　　　　file &quot;master/paching.idv.tw.db&quot;;<br>
      };</font><br>
      </font><font color="#00FFFF"># </font><font color="#00FFFF" size="2"> 宣告正解區域名稱為 
      paching.idv.tw。這個 zone 是您所申請回來的合法 domain name，</font><br>
      <font color="#00FFFF"># </font><font color="#00FFFF" size="2">請務必將其設定上去。由於這一台主機是 
      domain 裡邊所架設的第一台 DNS，因此</font><font color="#00FFFF" size="2">其 type</font><br>
      <font color="#00FFFF"># </font><font color="#00FFFF" size="2"> 為 master。再來就是指定正解區域的區域檔案為 
      master 目錄下的paching.idv.tw.db，</font><br> 
      <font color="#00FFFF">#<strong> </strong></font><font color="#00FFFF" size="2">所以等等需至</font> 
      <font color="#00FFFF" size="2">/var/lib/named/master<strong> </strong>目錄中去建立這個檔案。<br>
      <br>
      </font><font color="#FFFFFF"><font face="細明體">zone &quot;78.132.220.in-addr.arpa&quot; 
      in {<br>
      　　　　type master;<br>
      　　　　file &quot;master/220.132.78.db&quot;;<br>
      };</font><strong><br>
      </strong> </font><font color="#00FFFF"># </font><font color="#00FFFF" size="2">宣告反解區域名稱為 
      78.132.220.in-addr.arpa， type 一樣是 master，反解區域檔案名稱<br>
      </font><font color="#00FFFF"># </font><font color="#00FFFF" size="2">是 220.132.78.db，一樣需存在於 
      /var/lib/named/master 之中。</font><font color="#FFFFFF">&nbsp; </font></td>
  </tr>
</table>
<br>
　搞定了 named.conf 後，接下來就要開始設定正反解資料庫檔案了。<br>
<br>
<font color="#000000" size="+1"><strong><a name="21"></a><font size="5">12.5.2 
建立正解區域檔案</font></strong></font><br>
<br>
　DNS 提供給 DNS client 或其他 DNS 查詢的資料，就放在區域檔案裡，因此您必須在這個區域檔案中設定相關的紀錄來提供查詢，這些紀錄就是所謂的資源紀錄 
(Resource Record : 簡稱 RR)。而在每一筆的資源紀錄中，必需指定該筆紀錄所使用的類型 (RR type)，如 SOA、NS、MX、&#8230; 
等等。<br>
<br>
　另外在區域檔案中的註解符號為「;」，可不要與 /etc/named.conf 搞混了。<br>
<br>
　以下先看個範例，再來解釋其他的設定內容：<br>
<br>
<table width="100%" border="0">
  <tr> 
    <td nowrap bgcolor="#000000"><font color="#FFFFFF">suse:~ # <font color="#FFFF00"><strong>vi 
      /var/lib/named/master/paching.idv.tw.db</strong></font><br>
      <br>
      </font><font color="#FFFFFF" face="細明體">$TTL 43200<br>
      $ORIGIN paching.idv.tw.<br>
      @　　　 IN　　SOA　　dns.paching.idv.tw.　root.paching.idv.tw.　(<br>
      　　　　　　　　2006122501 <font color="#0099FF">; serial</font><br>
      　　　　　　　　21600<font color="#0099FF"> ; refresh</font><br>
      　　　　　　　　5400 <font color="#0099FF">; retry</font><br>
      　　　　　　　　864000<font color="#0099FF"> ; expire<br>
      </font>　　　　　　　　86400　)<font color="#0099FF"> ; minumum</font><br>
      　　　　IN　　NS 　　dns.paching.idv.tw.<strong><br>
      </strong></font><font color="#FFFFFF"><font color="#FFFF00" face="細明體">　　　　</font></font><font color="#FFFFFF" face="細明體">IN　　MX　10 
      mail.paching.idv.tw.<br>
      dns 　　IN　　A 　　 220.132.78.75<br>
      mail　　IN　　A　　　220.132.78.100<br>
      ftp　　 IN　　A　　　220.132.78.150<br>
      web　　 IN　　A　　　220.132.78.200<br>
      www　　 IN 　 CNAME　web</font><font color="#FFFFFF">&nbsp; &nbsp; <br>
      <font face="細明體">test　　IN　　CNAME　web</font> </font> </td>
  </tr>
</table>
<strong><br>
　</strong>第一行的 TTL 為 Time To Live 的簡稱，是用來告之對方 DNS 可以保留資源紀錄 (Resource Record) 在自己 
cache 多久的時間，以此為例就是 43200 秒。因為資源記錄是對方 DNS 向本機 DNS 查詢而取得，因此本機可用 TTL 來限定對方 DNS 可以 
cache 多久。當對方 DNS 在 TTL 時間內又遇到同一筆記錄查詢時，就可馬上從 cache 裡做出回應，而不必再向外界查詢。<br>
<br>
　另外在區域檔案中所設定的時間，如未指定單位，預設就是秒，當然也可以使用 H (小時)、D (天)、W (星期) 來做單位，像 43200 秒就可以用 12 
H 來表示。<br>
<br>
　第二行的 ORIGIN 是表示以下所設定的資源紀錄是來自於哪個區域，也就是針對哪個區域在做設定的意思啦，因此這個地方需設定為「paching.idv.tw.」，請留意結尾的「.」千萬不能遺漏。<br>
<br>
　在 DNS 紀錄中，名稱結尾加上個「.」之後，才表示是一個完整的 FQDN，如果您疏忽了這個點，可是會自動幫您於結尾再補上 ORIGIN 或 @，比如「mail.paching.idv.tw」就會變成「mail.paching.idv.tw.paching.idv.tw.」。<br>
<br>
　另外如果在 zone file 中未宣告 $ORIGIN，那麼就會套用 /etc/named.conf 中所宣告的區域名稱。<br>
<br>
　從第三行開始，就是在設定一些資源紀錄了，先來認識一下資源紀錄的設定格式：<br>
<br>
<table width="50%" border="0" bordercolor="#CCCCCC" bgcolor="#CCCCCC">
  <tr> 
    <td nowrap><strong>Reference　　[TTL]　　IN　　RR-type　 　Value</strong></td>
  </tr>
</table>
<br>
<table width="100%" border="0">
  <tr> 
    <td width="3%">&nbsp;</td>
    <td width="97%"><table width="100%" border="0">
        <tr> 
          <td width="3%" align="center" valign="top"><font size="5">˙</font></td>
          <td width="97%"><strong>Reference</strong>：是指定紀錄項目，可以是 hostname、domain、sub-domain 
            或 IP Address。</td>
        </tr>
        <tr> 
          <td align="center" valign="top"><font size="5">˙</font></td>
          <td><strong>TTL</strong>：您可以為每一筆資源記錄設定其 TTL，也可以省略而採用 $TTL 的設定值。</td>
        </tr>
        <tr> 
          <td align="center" valign="top"><font size="5">˙</font></td>
          <td><strong>IN</strong>：是表示該紀錄的類別 (Class) 為 Internet。</td>
        </tr>
        <tr> 
          <td align="center" valign="top"><font size="5">˙</font></td>
          <td><strong>RR-type</strong>：指定資源紀錄類型。在區域檔案裡常見到的 RR-type 有：<br> <table width="100%" border="0">
              <tr> 
                <td width="3%" align="center" valign="top"><font color="#000099" size="4">˙</font></td>
                <td width="97%"><font color="#000099"><strong>SOA：S</strong>tart 
                  <strong>O</strong>f <strong>A</strong>uthority。授權開始之意。在每個區域檔案中，只能存在一筆 
                  SOA 紀錄，而且必須是這個區域檔案裡的第一筆資源紀錄。</font></td>
              </tr>
              <tr> 
                <td align="center" valign="top"><font color="#000099" size="4">˙</font></td>
                <td><font color="#000099"><strong>NS：N</strong>ame<strong> S</strong>erver。指定負責管理這個 
                  zone 的名稱伺服器為何。</font></td>
              </tr>
              <tr> 
                <td align="center" valign="top"><font color="#000099" size="4">˙</font></td>
                <td><font color="#000099"><strong>MX：M</strong>ail e<strong>X</strong>changer。指定此 
                  zone 的郵件交換主機為何。 </font></td>
              </tr>
              <tr> 
                <td align="center" valign="top"><font color="#000099" size="4">˙</font></td>
                <td><font color="#000099"><strong>A：A</strong>ddress。設定 FQDN 所對應的 
                  IP 位址為何。</font></td>
              </tr>
              <tr> 
                <td align="center" valign="top"><font color="#000099" size="4">˙</font></td>
                <td><font color="#000099"><strong>CNAME：C</strong>anonical <strong>NAME</strong> 
                  (標準名稱)。這是別名的設定，可以運用在正解或反解的 zone file 裡。</font></td>
              </tr>
              <tr> 
                <td align="center" valign="top"><font color="#000099" size="4">˙</font></td>
                <td><font color="#000099"><strong>PTR：P</strong>oin<strong>T</strong>e<strong>R</strong>。一般用於反解紀錄中，也就是設定 
                  IP 位址所對應的 FQDN 為何。</font></td>
              </tr>
            </table></td>
        </tr>
        <tr> 
          <td align="center" valign="top"><font size="5">˙</font></td>
          <td><strong>Value</strong>：為紀錄值。至於 Value 要設定為何，則端看您所使用的 RR-type 才能做決定。比如 
            RR-type 為 NS，則 Value 就需指定為 domain 裡的 DNS 主機名稱 ﹔RR-type 是 MX，Value 
            則需指定這個 domain 的郵件交換主機名稱及優先權 (priority)。 </td>
        </tr>
      </table></td>
  </tr>
</table>
<br>
　另外在設定資源紀錄時，還有一些要注意的事項。首先每一筆資源紀錄只能佔用一行，也就是說同一筆資源紀錄不能使用 Enter 鍵將其斷至下一行，除非使用 ( )。以這個範例的 
SOA 紀錄來說，由於其所要設定的內容太多，一行放不下，這時候可以在 SOA 紀錄那一行的結尾處加上「(」，然後才按下 Enter 鍵來繼續設定其他的內容，等整個 
SOA 紀錄都設定完成後，再使用「)」做結束，這樣就表示 ( ) 中的內容與 SOA 紀錄是同一行的。<br>
<br>
　再來在設定一筆資源紀錄時，如該行開頭留有空白，則表示該筆記錄是承襲上一個紀錄項，如沒有留空白的話，那就代表是一筆新的資源紀錄。<br>
<br>
　接著就開始針對範例中區域檔案裡的每一筆資源紀錄做進一步的說明。<br>
<strong><br>
<img src="../picture/icon.jpg" tppabs="http://www.suse.url.tw/picture/icon.jpg" width="13" height="13"> <font color="#000099" size="4"></font><font color="#000099" size="4">SOA 
紀錄</font></strong><font color="#000099" size="4">：</font><br>
<br>
<table width="100%" border="0" bgcolor="#000000">
  <tr>
    <td><font color="#FFFFFF" face="細明體">@　　　 IN　　SOA　　dns.paching.idv.tw.　root.paching.idv.tw.　(<br>
      　　　　　　　　2006122501 <font color="#0099FF">; serial</font><br>
      　　　　　　　　21600<font color="#0099FF"> ; refresh</font><br>
      　　　　　　　　5400 <font color="#0099FF">; retry</font><br>
      　　　　　　　　864000<font color="#0099FF"> ; expire<br>
      </font>　　　　　　　　86400　)<font color="#0099FF"> ; minumum</font></font></td>
  </tr>
</table>
<br>
　這筆記錄中，最前頭的「@」就是 ORIGIN 的意思，也就是指 paching.idv.tw. 這個 zone。接著在 SOA 之後，分別要指定這個 zone 
的授權 DNS 主機名稱以及管理者信箱，請留意管理者的郵件地址中不能含有「@」字元，因「@」在這裡有其特殊涵義在，所以必須以 「.」來代替「@」。<br>
<br>
　再來就是括弧內的五組數字，這五組數字中，除 Serial 外，其他都是以秒為單位，當然您要使用 H、D、W 來做單位也行。以下分別來看看其所代表的涵義：<br>
<br>
<table width="100%" border="1">
  <tr> 
    <td width="10%" align="center" valign="middle" nowrap><strong><font color="#000099">Serial</font></strong></td>
    <td width="90%"><font color="#000099">序號。一般是以日期來呈現。當 Slave 要與 Master 進行資料同步時，就是以此序號作為判定標準，如 
      Slave 發現 Master 序號數字較大時，就進行資料庫更新，此時 Slave 會從 Master 上頭複製最新的資料庫資料回來，而這個動作就叫做 
      zone-transfer (區域移轉)。所以如果您 Master 主機上的資料庫有作過修改，請記得將此序號加大，若忘了這個動作，Slave 可是會認為 
      Master 的資料庫無任何異動。另外需注意 Serial 不能超過十位數字。</font></td>
  </tr>
  <tr> 
    <td align="center" valign="middle" nowrap><strong><font color="#000099">Refresh</font></strong></td>
    <td><font color="#000099">更新時間。當更新時間到的時候，Slave 會先跟 Master 做序號比對的動作，若發覺 Master 
      的序號較大時，則開始進行 zone-transfer。</font></td>
  </tr>
  <tr> 
    <td align="center" valign="middle" nowrap><strong><font color="#000099">Retry</font></strong></td>
    <td><font color="#000099">再嘗試時間。當 Slave 更新失敗後，需要隔多久時間再進行更新。</font></td>
  </tr>
  <tr> 
    <td align="center" valign="middle" nowrap><strong><font color="#000099">Expire</font></strong></td>
    <td><font color="#000099">若 Slave 在 Expire 所規定的期限內還無法更新成功，就放棄 Retry。</font></td>
  </tr>
  <tr> 
    <td align="center" valign="middle" nowrap><strong><font color="#000099">Minimum</font></strong></td>
    <td><font color="#000099">就是 TTL 啦，當您 $TTL 沒做設定時，就會以這裡的設定為主。</font></td>
  </tr>
</table>
<br>
　另外這些數值有一些限制您需要遵守：<br>
<br>
<strong>　˙Expire &gt;= Refresh + Retry<br>
　˙Expire &gt;= 10 × Retry<br>
　˙Refresh &gt;= 2 × Retry </strong><br>
　<br>
<strong><img src="../picture/icon.jpg" tppabs="http://www.suse.url.tw/picture/icon.jpg" width="13" height="13"> <font color="#000099" size="4">NS 
紀錄</font></strong><font color="#000099" size="4">：<br>
<br>
</font>
<table width="100%" border="0" bgcolor="#000000">
  <tr> 
    <td height="25"><font color="#FFFFFF" face="細明體">　　　　IN　　NS 　　dns.paching.idv.tw.</font></td>
  </tr>
</table>
<br>
　該筆記錄最前頭留有空白，表示是承襲上個紀錄項的內容，也就是 @，因此該行實際的設定內容為：<br>
<br>
<table width="50%" border="0" bordercolor="#CCCCCC" bgcolor="#CCCCCC">
  <tr> 
    <td height="25" nowrap>paching.idv.tw.　　IN　　NS　　dns.paching.idv.tw.</td>
  </tr>
</table>
<strong><br>
</strong>　意思是說，管理 paching.idv.tw. 這個 zone 的名稱伺服器為 dns.paching.idv.tw. 這台主機。<br>
<br>
<strong><img src="../picture/icon.jpg" tppabs="http://www.suse.url.tw/picture/icon.jpg" width="13" height="13"> <font color="#000099" size="4">MX 
紀錄</font></strong><font color="#000099" size="4">：</font><br>
<br>
<table width="100%" border="0" bgcolor="#000000">
  <tr> 
    <td><font color="#FFFFFF"><font color="#FFFF00" face="細明體">　　　　</font></font><font color="#FFFFFF" face="細明體">IN　　MX　10 
      mail.paching.idv.tw.</font></td>
  </tr>
</table>
<p>　該筆記錄的最前面也是留有空白，因此可以知道實際的設定內容為：</p>
<table width="50%" border="0" bordercolor="#CCCCCC" bgcolor="#CCCCCC">
  <tr> 
    <td height="25" nowrap>paching.idv.tw.　　IN　　MX 　10　mail.paching.idv.tw.</td>
  </tr>
</table>
<p> 　也就是說負責 paching.idv.tw. 的郵件交換主機為 mail.paching.idv.tw.。<br>
  <br>
  　另外在 MX 紀錄後所接的那個數字，是用來表示此台郵件主機的優先權 (priority or preference)，當您擁有一台以上的郵件交換主機時，就會以這個數字來決定查詢的優先順序，數字較小者會優先被查詢。<br>
  <br>
  　preference 的數值，一般習慣用 10、20、30、… 來做設定，當然您也可以使用 0、1、2 … 來設定。舉個例子：</p>
<table width="50%" border="0" bordercolor="#CCCCCC" bgcolor="#CCCCCC">
  <tr> 
    <td nowrap>paching.idv.tw.　　IN　　MX　10　mail1.paching.idv.tw.<br>
      paching.idv.tw.　　IN　　MX　20　mail2.paching.idv.tw.</td>
  </tr>
</table>
<p> 　這裡使用了兩筆 MX 紀錄，這樣當第一部郵件主機未做回應時，則會交由下一部做處理，不過如此做法並非真正將信件轉至另一台做收發，而只是暫時將信件佇留在那裡而已，等第一台主機恢復正常後，會再將佇留信件傳回，因而可達到郵件備援的目的。</p>
<p><strong><img src="../picture/icon.jpg" tppabs="http://www.suse.url.tw/picture/icon.jpg" width="13" height="13"> <font color="#000099" size="4">A 
  紀錄</font></strong><font color="#000099" size="4">：</font></p>
<table width="100%" border="0" bgcolor="#000000">
  <tr> 
    <td><font color="#FFFFFF" face="細明體">dns 　　IN　　A 　　 220.132.78.75<br>
      mail　　IN　　A　　　220.132.78.100<br>
      ftp　　 IN　　A　　　220.132.78.150<br>
      web　　 IN　　A　　　220.132.78.200</font></td>
  </tr>
</table>
<p><font color="#000099" size="4"> </font>　用來指出主機名稱所對應的 IP 位址。仔細觀察每一筆 A 紀錄前面的那個主機名稱，都沒有使用「.」做結尾，所以在這些名稱的後頭都會自動補上 
  @ 或 ORIGIN。以第一筆 A 紀錄來說，其實際的設定內容為：</p>
<table width="50%" border="0" bordercolor="#CCCCCC" bgcolor="#CCCCCC">
  <tr> 
    <td height="26" nowrap>dns.paching.idv.tw.　　IN　　A　　220.132.78.75</td>
  </tr>
</table>
<br>
　在正解區域檔案裡，對於 NS 及 MX 後所宣告的 FQDN，必需分別為其指定一筆 A 紀錄才行。<br>
<strong> <br>
<img src="../picture/icon.jpg" tppabs="http://www.suse.url.tw/picture/icon.jpg" width="13" height="13"> <font color="#000099" size="4">CNAME 
紀錄</font></strong><font color="#000099" size="4">：<br>
<br>
</font>
<table width="100%" border="0" bgcolor="#000000">
  <tr> 
    <td><font color="#FFFFFF" face="細明體">web　　 IN　　A　　　　220.132.78.200<br>
      www　　 IN 　 CNAME　　web</font><font color="#FFFFFF">&nbsp;<br>
      <font face="細明體">test　　IN　　CNAME　　web</font> </font></td>
  </tr>
</table>
<p><font color="#000099"><font color="#000000">　</font><font color="#000000">這是用來設定主機別名，當您主機擁有其他名稱且都指向同一個 
  IP 位址時，就可以使用 CNAME 來搞定。而上面這個範例的意思是說，當查詢 www 或 test 時，就會轉而向 CNAME 右邊的 web 做查詢，然後再根據 
  web 的 A 紀錄而順利找到這台主機的位址，因此 www 及 test 就是屬於 web 的別名。當然您也可以不要使用 CNAME，就直接指定 www 
  及 test 的 A 紀錄也行，只是將來要修改 IP 位址時，需分別對 www、web 及 test 做修改，而使用了 CNAME 之後，就只需修改 web 
  的 A 紀錄即可。<br>
  <br>
  　不過使用 CNAME 時，以這個範例而言，會多產生一次的查詢，如果設定成以下的範例，則對 www 而言，更會多產生兩次的查詢：</font></font></p>
<table width="50%" border="0" bordercolor="#CCCCCC" bgcolor="#CCCCCC">
  <tr> 
    <td nowrap><font face="細明體">web　　IN　A　　　　220.132.78.200<br>
      test　 IN　CNAME　　web<br>
      www　　IN　CNAME　　test</font></td>
  </tr>
</table>
<p> 　當查詢一筆記錄時，產生愈多次的查詢，就愈會浪費 DNS 的資源，且其查詢效率也打了點折扣，因此建議採用範例一的 CNAME 設定會比較恰當。 <br>
  <br>
  <font color="#000000" size="+1"><strong><a name="22"></a><font size="5">12.5.3 
  建立反解區域檔案</font></strong></font><br>
  <br>
  　這個檔案主要是設定 IP 位址所對應 FQDN 的紀錄，請看以下範例：</p>
<table width="100%" border="0">
  <tr> 
    <td nowrap bgcolor="#000000"><font color="#FFFFFF">suse:~ # <font color="#FFFF00"><strong>vi 
      /var/lib/named/master/220.132.78.db</strong></font><br>
      </font><font color="#FFFFFF" face="細明體">$TTL 43200<br>
      $ORIGIN 78.132.220.in-addr.arpa.<br>
      @　　　IN　　SOA　　dns.paching.idv.tw.　root.paching.idv.tw.　(<br>
      　　　　　 　2006122501 <font color="#0099FF">; serial</font><br>
      　　　　　 　21600<font color="#0099FF"> ; refresh</font><br>
      　　　　　 　5400 <font color="#0099FF">; retry</font><br>
      　　　　　 　864000<font color="#0099FF"> ; expire</font><br>
      　　　　　 　86400　)<font color="#0099FF"> ; minumum<br>
      </font>　　 　IN　　NS　　 dns.paching.idv.tw.<font color="#FFFF00"> </font></font><font color="#FFFFFF"><font color="#FFFF00" face="細明體"><br>
      <font color="#FFFFFF">75</font> 　　</font></font><font color="#FFFFFF" face="細明體">IN　　PTR　　dns.paching.idv.tw.</font><br> 
      <font color="#FFFFFF" face="細明體">100</font><font face="細明體">　　</font><font color="#FFFFFF" face="細明體">IN　　PTR　　mail.paching.idv.tw.</font><br> 
      <font face="細明體"> <font color="#FFFFFF">150</font>　　</font><font color="#FFFFFF" face="細明體">IN　　PTR　　ftp.paching.idv.tw.</font><br> 
      <font face="細明體"> <font color="#FFFFFF">200</font>　　</font><font color="#FFFFFF" face="細明體">IN　　PTR　　web.paching.idv.tw.</font> 
    </td>
  </tr>
</table>
<br>
<font color="#000000"> <strong>　</strong>由於這是在設定反解的資料庫，因此 $ORIGIN 需指定反解區域名稱，若未設定 
$ORIGIN，則以 named.conf 裡所宣告的 zone 為主。至於其他的補充說明如下：<br>
<br>
<strong><img src="../picture/icon.jpg" tppabs="http://www.suse.url.tw/picture/icon.jpg" width="13" height="13"> <font color="#000099" size="4">SOA 
紀錄：</font></strong><br>
<br>
　該紀錄中的 &quot; @ &quot; 代表 78.132.220.in-addr.arpa. 這個反解區域，至於此區域的授權主機為 dns.paching.idv.tw. 
這一台。另外您要清楚的是正解區域與反解區域的授權主機可以是不同台，只不過我們這邊是把正反解都設定在同一台罷了。<br>
</font> <font color="#000000"><br>
<strong><img src="../picture/icon.jpg" tppabs="http://www.suse.url.tw/picture/icon.jpg" width="13" height="13"> <font color="#000099" size="4">NS 
紀錄：</font></strong><br>
<br>
　設定負責這個反解區域的名稱伺服器為 dns.paching.idv.tw. 。<br>
<br>
</font> <font color="#000000"> <strong><img src="../picture/icon.jpg" tppabs="http://www.suse.url.tw/picture/icon.jpg" width="13" height="13"> 
<font color="#000099" size="4">PTR 紀錄：</font></strong><br>
<br>
　設定 IP 位址所對應的 FQDN 為何，比如以範例中的第一筆 PTR 紀錄來說，就是在為 220.132.78.75 設定反解，而在 75 這個數字的後面沒有以「. 
」做結尾，那當然就會自動於其後補上 @ 或 ORIGIN 囉，因此實際的設定內容為：<br>
<br>
</font> 
<table width="50%" border="0" bordercolor="#CCCCCC" bgcolor="#CCCCCC">
  <tr> 
    <td height="25" nowrap><font color="#000000">75.78.132.220.in-addr.arpa.　　IN　　PTR　 
      dns.paching.idv.tw.</font></td>
  </tr>
</table>
<font color="#000000"><br>
</font> <font color="#000000"><br>
</font><strong><font size="+1"><a name="23"></a><font size="5">12.5.4 測試 DNS</font></font></strong><br>
<br>
　在測試 DNS 能否正常運作之前，請先將 DNS 啟動，然後設定好 DNS client 端之後，就可以開始進行測試了。<br>
<br>
<strong><font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"></font> 
<font size="4">啟動 named 服務</font></strong><br>
<br>
　當您 named.conf 及正反解區域檔案都已設定完畢後，請啟動 DNS 服務：<br>
<br>
<table width="100%" border="0">
  <tr> 
    <td bgcolor="#000000"><font color="#FFFFFF">suse:~ #<font color="#FFFF00"><strong> 
      /etc/init.d/named start</strong></font><br>
      Starting name server BIND　　　　　　　　<font color="#00FF00">　　done</font><br>
      <br>
      <font color="#00FFFF"># </font><font color="#FFFFFF"><font color="#00FFFF" size="2">當</font></font><font color="#00FFFF" size="2">然使用 
      rcnamed 也行：</font><br>
      suse:~ #<font color="#FFFF00"><strong> rcnamed start</strong></font><br>
      Starting name server BIND　　　　　　　　<font color="#00FF00">　　done </font></font></td>
  </tr>
</table>
<font color="#000000"><br>
</font> 　將來要是修改了 DNS 相關檔案後，可不要忘了重新啟動 named 服務噢。<br>
<br>
　DNS 啟動後有一動作非常重要，就是檢視<strong> /var/log/messages</strong> 這個紀錄檔，只要 DNS 設定有問題時，都會將一些錯誤訊息顯示在這個檔案內：<br>
<br>
<table width="100%" border="0">
  <tr> 
    <td nowrap bgcolor="#000000"><font color="#FFFFFF">suse:~ # <font color="#FFFF00"><strong>cat 
      /var/log/messages</strong></font><br>
      Jan 19 16:42:13 suse named[3729]: starting BIND 9.3.2 -t /var/lib/named 
      -u named<br>
      Jan 19 16:42:13 suse named[3729]: found 1 CPU, using 1 worker thread<br>
      Jan 19 16:42:13 suse named[3729]: loading configuration from '/etc/named.conf'<br>
      Jan 19 16:42:13 suse named[3729]: listening on IPv6 interfaces, port 53<br>
      Jan 19 16:42:13 suse named[3729]: listening on IPv4 interface lo, 127.0.0.1#53<br>
      Jan 19 16:42:13 suse named[3729]: listening on IPv4 interface eth0, 192.168.1.111#53<br>
      Jan 19 16:42:13 suse named[3729]: command channel listening on 127.0.0.1#953<br>
      Jan 19 16:42:13 suse named[3729]: command channel listening on ::1#953<br>
      Jan 19 16:42:13 suse named[3729]: zone 0.0.127.in-addr.arpa/IN: loaded serial 
      42<br>
      Jan 19 16:42:13 suse named[3729]: zone 78.132.220.in-addr.arpa/IN: loaded 
      serial 2006122501<br>
      Jan 19 16:42:13 suse named[3729]: zone localhost/IN: loaded serial 42<br>
      Jan 19 16:42:13 suse named[3729]: zone paching.idv.tw/IN: loaded serial 
      2006122501<br>
      Jan 19 16:42:13 suse named[3729]: running</font></td>
  </tr>
</table>
<br>
<strong><font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"></font> 
<font size="4">設定 DNS client</font></strong><br>
<br>
　等一下要對剛剛才架設好的 DNS 做測試的動作，因此需先設定好您的 client 端才行。您可以拿另一台 windows 或 linux 主機當成 DNS 
client，並在上頭指定好所使用的 DNS 伺服器位址為 220.132.78.75，或者也可以直接在本機上進行測試，意即將本機當成既是 DNS 的 client 
端也是 DNS 的 server 端，而現在我們所要採取的就是這種方式，因此請先將 resolv.conf<strong> </strong>搞定：<br>
<br>
<table width="100%" border="0">
  <tr> 
    <td bgcolor="#000000"><font color="#FFFFFF">suse:~ # <font color="#FFFF00"><strong>vi 
      /etc/resolv.conf</strong></font><br>
      nameserver 220.132.78.75<br>
      <font color="#00FFFF">#</font><font color="#00FFFF" size="2"> 此處的 DNS 位址，也可設定成 
      0.0.0.0 或 127.0.0.1。</font></font></td>
  </tr>
</table>
<br>
<strong><font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"></font> 
<font size="4">測試 DNS</font></strong><br>
<br>
　這裡會使用 <strong>nslookup </strong>指令來作測試，至於 nslookup 的詳細用法，稍後馬上會提到。<br>
<br>
<table width="100%" border="0">
  <tr> 
    <td nowrap bgcolor="#000000"><font color="#FFFFFF">suse:~ # <font color="#FFFF00"><strong>nslookup 
      mail.paching.idv.tw</strong></font> </font><font color="#00FFFF" size="2">→ 
      查詢 mail 主機的位址。</font><font color="#FFFFFF"><br>
      <font face="細明體">Server: 　　　220.132.78.75<br>
      Address: 　　 220.132.78.75#53 </font><font color="#00FFFF" size="2">→ 這是在 
      resolv.conf 裡所指定的 default ns。</font><font face="細明體"> 
      <p>Name: 　mail.paching.idv.tw<br>
        Address: 220.132.78.100 <font color="#00FFFF" size="2">→ 這是查詢結果。</font><font color="#FFFFFF"> 
        </font></p>
      </font></font><font color="#FFFFFF"> 
      <p>suse:~ # <strong><font color="#FFFF00">nslookup www.paching.idv.tw</font></strong> 
        <font color="#00FFFF" size="2">→ 查詢 www 主機的位址。</font><font color="#FFFFFF"> 
        <br>
        <font face="細明體">Server: 　　　220.132.78.75<br>
        Address: 　　 220.132.78.75#53</font> </font></p>
      </font><font color="#FFFFFF"> 
      <p><font face="細明體">www.paching.idv.tw canonical name = web.paching.idv.tw.<br>
        Name: 　web.paching.idv.tw<br>
        Address: 220.132.78.200 </font><font color="#00FFFF" size="2">→ 這是查詢結果。</font></p>
      <p>suse:~ # <font color="#FFFF00"><strong>nslookup 220.132.78.150</strong></font> 
        <font color="#00FFFF" size="2">→ 查詢此 IP 所對應的 FQDN。</font><font color="#FFFFFF"> 
        <br>
        <font face="細明體">Server: 　　　220.132.78.75<br>
        Address: 　　 220.132.78.75#53</font> </font></p>
      </font><font color="#FFFFFF"> 
      <p><font face="細明體">150.78.132.220.in-addr.arpa name = ftp.paching.idv.tw.<br>
        </font><font color="#FFFFFF"><font color="#00FFFF" size="2">→ 這是查詢結果。</font></font><font face="細明體"> 
        </font></p>
      </font> </td>
  </tr>
</table>
<br>
<br>
<strong><font color="#000000" size="+1"><a name="24"></a><font size="5">12.5.5 
Client 端常用來作名稱查詢的工具</font></font></strong><br>
<br>
　這一小節除了介紹剛剛才用過的 nslookup 外，還會介紹 dig 及 host 指令。以下分別來說明這些指令的用法。<br>
　<br>
<font size="+1"><strong><a name="25"></a><font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"></font> 
指令 nslookup</strong></font><br>
<br>
<strong>指令語法</strong>：<br>
<table width="100%" border="0" bgcolor="#CCCCCC">
  <tr> 
    <td><strong><font face="細明體">nslookup [FQDN | Address] [name-server]</font></strong></td>
  </tr>
</table>
<br>
　最後那個 name-server，是您所指定的預設名稱伺服器，可以是主機名稱或 IP 位址，如未指定，則以 resolv.conf 所設定的 nameserver 
為主。<strong><br>
<br>
　</strong>nslookup 有兩種查詢模式：<br>
<table width="100%" border="0">
  <tr> 
    <td width="2%" align="center" valign="top" nowrap>&nbsp;</td>
    <td width="3%" align="center" valign="top" nowrap><strong>1</strong>.</td>
    <td width="95%"><strong>非交談模式</strong> (Non-interactive mode)：<br>
      就是指令語法中所介紹的那種方式。</td>
  </tr>
  <tr> 
    <td align="center" valign="top" nowrap>&nbsp;</td>
    <td align="center" valign="top" nowrap><strong>2</strong>.</td>
    <td><strong>交談模式</strong> (Interactive mode)：<br>
      執行 nslookup 時，如指令之後沒接任何引數，就可以直接進入到交談模式。而在交談模式下，可使用 &quot; <strong>set type</strong> 
      &quot; (或 set q) 來指定要查詢的紀錄類別，比如 set type=[A、NS、MX、SOA、PTR、CNAME、ANY] 等，預設為 
      set type=A。</td>
  </tr>
</table>
<br>
<strong>範例說明</strong>：<br>
<table width="100%" border="0">
  <tr> 
    <td nowrap bgcolor="#000000"><font color="#FFFFFF">suse:~ # <font color="#FFFF00"><strong>nslookup 
      www.sina.com.tw 168.95.1.1</strong></font><br>
      <font face="細明體">Server: 　　　168.95.1.1<br>
      Address: 　　 168.95.1.1#53</font></font> <font color="#FFFFFF"><font color="#FFFFFF"><font color="#00FFFF" size="2">→</font></font><font color="#00FFFF" size="2"> 
      Default Name Server 已改了噢<font face="細明體">。</font></font></font> <p><font color="#FFFFFF" face="細明體">Non-authoritative 
        answer:<br>
        Name: www.sina.com.tw<br>
        Address: 210.17.38.45</font></p>
      <font color="#FFFFFF">suse:~ # <font color="#FFFF00"><strong>nslookup</strong></font><br>
      &gt; <font color="#FFFF00">set type=NS</font> <font color="#FFFFFF"><font color="#00FFFF" size="2">→</font></font><font color="#00FFFF" size="2"> 
      設定查詢類型為 NS 紀錄<font face="細明體">。</font></font></font> <font color="#FFFFFF"><br>
      &gt; <font color="#FFFF00">microsoft.com.</font> <font color="#FFFFFF"><font color="#00FFFF" size="2">→</font></font><font color="#00FFFF" size="2"> 
      </font></font><font color="#00FFFF" size="2">查詢 microsoft.com 的 name server 
      有哪些。 </font><font color="#FFFFFF"><br>
      <font face="細明體">Server: 　　　220.132.78.75<br>
      Address: 　　 220.132.78.75#53</font></font> <p><font color="#FFFFFF" face="細明體">Non-authoritative 
        answer:<br>
        microsoft.com　nameserver = ns3.msft.net.<br>
        microsoft.com　nameserver = ns4.msft.net.<br>
        microsoft.com　nameserver = ns5.msft.net.<br>
        microsoft.com　nameserver = ns1.msft.net.<br>
        microsoft.com　nameserver = ns2.msft.net.</font></p>
      <p><font color="#FFFFFF" face="細明體">Authoritative answers can be found from:<br>
        ns1.msft.net　 internet address = 207.68.160.190<br>
        ns2.msft.net 　internet address = 65.54.240.126<br>
        ns3.msft.net 　internet address = 213.199.144.151<br>
        ns4.msft.net 　internet address = 207.46.66.126<br>
        ns5.msft.net 　internet address = 65.55.238.126<br>
        &gt; <font color="#FFFF00">server 168.95.192.2</font> </font><font color="#FFFFFF"><font color="#FFFFFF"><font color="#00FFFF" size="2">→</font></font><font color="#00FFFF" size="2"> 
        指定 Default Name Server 為 168.95.192.2<font face="細明體">。</font></font></font><font color="#FFFFFF" face="細明體"><br>
        Default server: 168.95.192.2<br>
        Address: 168.95.192.2#53 <br>
        &gt; <font color="#FFFF00">set type=MX</font> </font><font color="#00FFFF" size="2">→ 
        設定查詢類型為 MX 紀錄。</font><font color="#FFFFFF" face="細明體"><br>
        &gt; <font color="#FFFF00">ntu.edu.tw.</font> </font><font color="#00FFFF" size="2">→ 
        查詢台大網域的郵件交換主機。</font><font color="#FFFFFF" face="細明體"><br>
        Server: 　　　168.95.192.2<br>
        Address: 　　 168.95.192.2#53 </font><font color="#00FFFF" size="2">→ Default 
        Name Server 已改為這台囉<font face="細明體">。</font></font></p>
      <p><font color="#FFFFFF" face="細明體">Non-authoritative answer:<br>
        ntu.edu.tw 　　 mail exchanger = 0 ccsun9.cc.ntu.edu.tw.<br>
        ntu.edu.tw　　　mail exchanger = 0 ccsun41.cc.ntu.edu.tw.<br>
        ntu.edu.tw　　　mail exchanger = 0 ccsun42.cc.ntu.edu.tw.<br>
        ntu.edu.tw 　　 mail exchanger = 0 ccsun8.cc.ntu.edu.tw.</font></p>
      <p><font color="#FFFFFF" face="細明體">Authoritative answers can be found from:<br>
        ntu.edu.tw　　　nameserver = dns.ntu.edu.tw.<br>
        ntu.edu.tw 　　 nameserver = ntu3.ntu.edu.tw.<br>
        ccsun9.cc.ntu.edu.tw　　internet address = 140.112.8.9<br>
        ccsun41.cc.ntu.edu.tw 　internet address = 140.112.8.41<br>
        ccsun42.cc.ntu.edu.tw　 internet address = 140.112.8.42<br>
        ccsun8.cc.ntu.edu.tw 　 internet address = 140.112.8.8<br>
        dns.ntu.edu.tw　internet address = 140.112.254.4<br>
        dns.ntu.edu.tw　internet address = 163.28.16.10<br>
        ntu3.ntu.edu.tw internet address = 140.112.2.2<br>
        </font><font color="#FFFFFF">&gt; <font color="#FFFF00">set q=SOA</font> 
        </font><font color="#00FFFF" size="2">→ 設定查詢類別為 SOA 紀錄。</font><font color="#FFFFFF"> 
        <br>
        &gt; <font color="#FFFF00">google.com.</font> </font><font color="#00FFFF" size="2">→ 
        查詢 google.com 的 SOA 資訊。</font><font color="#FFFFFF"><br>
        <font face="細明體">Server: 　　　168.95.192.2<br>
        Address: 　　 168.95.192.2#53</font></font></p>
      <p><font color="#FFFFFF" face="細明體">Non-authoritative answer:<br>
        google.com<br>
        　　　　origin = ns1.google.com<br>
        　　　　mail addr = dns-admin.google.com<br>
        　　　　serial = 2007011600<br>
        　　　　refresh = 7200<br>
        　　　　retry = 1800<br>
        　　　　expire = 1209600<br>
        　　　　minimum = 300</font></p>
      <p><font color="#FFFFFF" face="細明體">Authoritative answers can be found from:<br>
        google.com 　　nameserver = ns1.google.com.<br>
        google.com 　　nameserver = ns2.google.com.<br>
        google.com 　　nameserver = ns3.google.com.<br>
        google.com 　　nameserver = ns4.google.com.<br>
        ns1.google.com internet address = 216.239.32.10<br>
        ns2.google.com internet address = 216.239.34.10<br>
        ns3.google.com internet address = 216.239.36.10<br>
        ns4.google.com internet address = 216.239.38.10<br>
        </font><font color="#FFFFFF">&gt;<strong> <font color="#FFFF00">exit</font></strong><font color="#00FFFF"> 
        <font size="2">→ 退出 nslookup。也可以使用 Ctrl-D。</font></font></font><font color="#FFFFFF" face="細明體"> 
        </font></p>
      <font color="#FFFFFF">suse:~ #</font></td>
  </tr>
</table>
<strong><br>
</strong>　以上範例中，如果看到 &quot; <strong>Non-authoritative answer</strong>&quot; ，就表示該項查詢紀錄並非您指定的那台 
default name server 所管轄，而是由其他的 DNS 所查詢而來，只是暫時存放在自己的 cache 內而已。<br>
<br>
<font color="#000000" size="+1"><strong><a name="26"></a></strong></font><font size="+1"><strong><font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"></font></strong></font><font color="#000000" size="+1"><strong> 
指令 dig</strong></font><br>
<br>
<strong>指令語法</strong>：<br>
<table width="100%" border="0" bgcolor="#CCCCCC">
  <tr> 
    <td><strong><font face="細明體">dig [@server] [-t type] [-x addr] [FQDN]</font></strong></td>
  </tr>
</table>
<br>
　dig 是個很好用的查詢工具，與 nslookup 比較起來，真是有過之而無不及。<br>
<br>
<strong>參數說明</strong>：<br>
<table width="100%" border="1">
  <tr> 
    <td width="8%" align="center" valign="middle" nowrap><strong><font color="#000099">@server</font></strong></td>
    <td width="92%"><font color="#000099">指定 Default Name Server，server 可以是主機名稱或 
      IP 位址。如果未使用 @server，則依據 /etc/resolv.conf 中所設定的 nameserver 為主。</font></td>
  </tr>
  <tr> 
    <td align="center" valign="middle" nowrap><strong><font color="#000099">-t 
      type</font></strong></td>
    <td><font color="#000099">設定查詢的紀錄類型。type 可以是 SOA、NS、MX、CNAME、A 紀錄及 ANY 等，預設為 
      A 紀錄。</font></td>
  </tr>
  <tr> 
    <td align="center" valign="middle" nowrap><strong><font color="#000099">-x 
      addr</font></strong></td>
    <td><font color="#000099">查反解用的，其後需接 Address，且不需搭配 -t 參數及 FQDN。</font></td>
  </tr>
</table>
<strong><br>
範例說明</strong>：<br>
<table width="100%" border="0">
  <tr> 
    <td nowrap bgcolor="#000000"><font color="#FFFFFF">suse:~ #<font color="#FFFF00"><strong> 
      dig -t mx slime.com.tw</strong></font></font> <font color="#FFFFFF"><font color="#FFFF00"><font color="#FFFFFF"><font color="#FFFF00"><font color="#FFFFFF"><font color="#FFFF00"><font color="#FFFFFF"><font color="#00FFFF"><font size="2">→</font></font></font><font color="#00FFFF" size="2"> 
      查詢 slime.com.tw 的 MX 紀錄。</font></font></font></font></font></font></font> 
      <p><font color="#FFFFFF" face="細明體">; &lt;&lt;&gt;&gt; DiG 9.3.2 &lt;&lt;&gt;&gt; 
        -t mx slime.com.tw<br>
        ;; global options: printcmd<br>
        ;; Got answer:<br>
        ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 32164<br>
        ;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 2, ADDITIONAL: 1</font></p>
      <p><font color="#FFFFFF" face="細明體">;; QUESTION SECTION:<br>
        ;slime.com.tw. 　　　　　　 IN 　MX</font></p>
      <p><font color="#FFFFFF" face="細明體">;; ANSWER SECTION:<br>
        slime.com.tw. 　　　10800 　IN 　MX 　10 www.slime.com.tw.</font></p>
      <p><font color="#FFFFFF" face="細明體">;; AUTHORITY SECTION:<br>
        slime.com.tw. 　　　10800 　IN 　NS 　ns1.slime.com.tw.<br>
        slime.com.tw. 　　　10800 　IN 　NS 　ns2.slime.com.tw.</font></p>
      <p><font color="#FFFFFF" face="細明體">;; ADDITIONAL SECTION:<br>
        www.slime.com.tw. 　10800 　IN 　A 　 220.228.161.112</font></p>
      <p><font color="#FFFFFF" face="細明體">;; Query time: 90 msec<br>
        ;; SERVER: 220.132.78.75#53(220.132.78.75)<br>
        ;; WHEN: Fri Jan 19 11:55:58 2007<br>
        ;; MSG SIZE rcvd: 102</font></p>
      <font color="#FFFFFF">suse:~ #<font color="#FFFF00"><strong> dig @168.95.1.1 
      -x 168.95.192.1</strong></font></font> <br>
      <font color="#00FFFF"># </font><font color="#00FFFF" size="2">向 168.95.1.1 
      這台 DNS，查詢 168.95.192.1 這個 ip 位址所對應的 FQDN。</font><br> <p><font color="#FFFFFF" face="細明體">; 
        &lt;&lt;&gt;&gt; DiG 9.3.2 &lt;&lt;&gt;&gt; @168.95.1.1 -x 168.95.192.1<br>
        ; (1 server found)<br>
        ;; global options: printcmd<br>
        ;; Got answer:<br>
        ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 11047<br>
        ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 3, ADDITIONAL: 
        3</font></p>
      <p><font color="#FFFFFF" face="細明體">;; QUESTION SECTION:<br>
        ;1.192.95.168.in-addr.arpa. 　　 IN PTR</font></p>
      <p><font color="#FFFFFF" face="細明體">;; ANSWER SECTION:<br>
        1.192.95.168.in-addr.arpa. 86400 IN PTR hntp1.hinet.net.</font></p>
      <p><font color="#FFFFFF" face="細明體">;; AUTHORITY SECTION:<br>
        192.95.168.in-addr.arpa. 　86400 IN NS　hntp1.hinet.net.<br>
        192.95.168.in-addr.arpa. 　86400 IN NS　hntp3.hinet.net.<br>
        192.95.168.in-addr.arpa. 　86400 IN NS　dns.hinet.net.</font></p>
      <p><font color="#FFFFFF" face="細明體">;; ADDITIONAL SECTION:<br>
        hntp1.hinet.net. 　　　　　86400 IN A 　168.95.192.1<br>
        hntp3.hinet.net. 　　　　　86400 IN A 　168.95.192.2<br>
        dns.hinet.net. 　　　　　　86400 IN A 　168.95.1.1</font></p>
      <p><font color="#FFFFFF" face="細明體">;; Query time: 59 msec<br>
        ;; SERVER: 168.95.1.1#53(168.95.1.1)<br>
        ;; WHEN: Fri Jan 19 12:03:08 2007<br>
        ;; MSG SIZE rcvd: 195</font></p></td>
  </tr>
</table>
<br>
<font color="#000000" size="+1"><strong><a name="27"></a></strong></font><font size="+1"><strong><font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"></font></strong></font><font color="#000000" size="+1"><strong> 
指令 host</strong></font><br>
<br>
<strong>指令語法</strong>：<br>
<table width="100%" border="0" bgcolor="#CCCCCC">
  <tr> 
    <td><strong><font face="細明體">host [-a] [-t type] [FQDN | Address] [name-server]</font></strong></td>
  </tr>
</table>
<br>
　-a 為 any 之意。-t 是指定查詢的紀錄類別，預設為 A 紀錄。至於後面的部分與 nslookup 相同。<strong><br>
<br>
範例說明</strong>：<br>
<table width="100%" border="0">
  <tr> 
    <td nowrap bgcolor="#000000"><font color="#FFFFFF">suse:~ # <font color="#FFFF00"><strong>host 
      www.pchome.com.tw</strong></font> <font color="#FFFF00"><font color="#FFFFFF"><font color="#FFFF00"><font color="#FFFFFF"><font color="#FFFF00"><font color="#FFFFFF"><font color="#00FFFF"><font size="2">→</font></font></font><font color="#00FFFF" size="2"> 
      查詢此 FQDN 所對應之 IP。</font></font></font></font></font></font><br>
      www.pchome.com.tw has address 210.59.230.60<br>
      <br>
      suse:~ # <font color="#FFFF00"><strong>host 220.132.78.100</strong></font> 
      <font color="#FFFF00"><font color="#FFFFFF"><font color="#FFFF00"><font color="#FFFFFF"><font color="#FFFF00"><font color="#FFFFFF"><font color="#00FFFF"><font size="2">→</font></font></font><font color="#00FFFF" size="2"> 
      查詢此 IP 所對應的 FQDN</font></font></font></font></font></font> <br>
      100.78.132.220.in-addr.arpa domain name pointer mail.paching.idv.tw.<br>
      <br>
      suse:~ #<font color="#FFFF00"><strong> host -t ns sina.com.tw 168.95.1.1</strong></font> 
      <font color="#FFFF00"><font color="#FFFFFF"><font color="#FFFF00"><font color="#FFFFFF"><font color="#FFFF00"><font color="#FFFFFF"><font color="#00FFFF"><br>
      # </font></font><font color="#00FFFF" size="2">向 168.95.1.1 查詢 sina.com.tw 
      的 ns 紀錄。</font></font></font></font></font></font> <br>
      Using domain server:<br>
      Name: 168.95.1.1<br>
      Address: 168.95.1.1#53<br>
      Aliases:</font> <p><font color="#FFFFFF">sina.com.tw name server ns1.sina.com.tw.<br>
        sina.com.tw name server tao.sina.com.tw.</font></p>
      <font color="#FFFFFF">suse:~ # <font color="#FFFF00"><strong>host -a yam.com.tw</strong></font> 
      <font color="#FFFF00"><font color="#FFFFFF"><font color="#FFFF00"><font color="#FFFFFF"><font color="#FFFF00"><font color="#FFFFFF"><font color="#00FFFF"><font size="2">→</font></font></font><font color="#00FFFF" size="2"> 
      查詢 yam.com.tw 的任何相關資訊。</font></font></font></font></font></font> <br>
      <font face="細明體">Trying &quot;yam.com.tw&quot;<br>
      ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 45961<br>
      ;; flags: qr rd ra; QUERY: 1, ANSWER: 5, AUTHORITY: 2, ADDITIONAL: 3</font></font> 
      <br> <br> <font color="#FFFFFF" face="細明體">;</font><font face="細明體"><font color="#FFFFFF">; 
      QUESTION SECTION:<br>
      ;yam.com.tw. 　　　　　　　　IN　ANY</font></font> <p><font color="#FFFFFF" face="細明體">;; 
        ANSWER SECTION:<br>
        yam.com.tw.　　　　604800　IN　A 　　211.72.254.6<br>
        yam.com.tw.　　　　604800　IN　MX 　 20 ms.yam.com.tw.<br>
        yam.com.tw.　　　　604800　IN　SOA 　dns1.yam.com.tw. dnsadm.staff.yam.com.<br>
        2006110306 86400 7200 360000 86400<br>
        yam.com.tw.　　　　604800　IN　NS 　 dns1.yam.com.tw.<br>
        yam.com.tw.　　　　604800　IN　NS　　dns2.yam.com.tw.</font></p>
      <p><font color="#FFFFFF" face="細明體">;; AUTHORITY SECTION:<br>
        yam.com.tw.　　　　604800　IN　NS　　dns2.yam.com.tw.<br>
        yam.com.tw. 　　　 604800　IN　NS　　dns1.yam.com.tw.</font></p>
      <p><font color="#FFFFFF" face="細明體">;; ADDITIONAL SECTION:<br>
        ms.yam.com.tw. 　　21600　 IN　A　　 211.72.254.200<br>
        dns1.yam.com.tw. 　604800　IN　A 　　211.72.254.5<br>
        dns2.yam.com.tw. 　604800　IN　A 　　211.72.254.4</font></p>
      <p><font color="#FFFFFF" face="細明體">Received 233 bytes from 220.132.78.75#53 
        in 854 ms</font></p></td>
  </tr>
</table>
<br>
<strong><font color="#0000FF" size="+1"><br>
<a name="28"></a><font size="6">12.6 </font></font></strong><font color="#0000FF" size="6"><strong>設定 
Slave DNS </strong></font><font size="+1"><br>
<br>
</font> 　當您有了合法的 domain name 以後，若想自己架設 DNS，尚需向上游登記您 DNS 主機的資訊，此時通常會要求您提供兩台 DNS 
的位址，這樣做的好處是萬一有一台 DNS 出問題時，還有另一台可提供查詢，也就因為如此才會有 Slave 的產生。不過對於上層的 DNS 來說，它只管授權給下層的 
DNS 去管理自己 zone 裡邊的主機資料，並不會幫您區分哪一台是 Master 哪一台是 Slave，至於最後到底會向哪台 DNS 做查詢，答案是都有可能，因為查詢時有可能是經由 
random (亂數) 或者是 round robin (輪詢) 這一類的方式。<br>
<br>
　經由 Master 與 Slave 的搭配，要是哪天區域檔案內的資料有異動時，只需對 Master 作修改即可，至於 Slave 會在 refresh 時間到達時或 
Master 重新啟動 named 服務時，而嘗試與 Master 做資料同步的動作。<br>
<br>
<font size="+1"><strong><a name="29"></a><font size="5">12.6.1 設定 Slave DNS</font></strong></font> 
<br>
<br>
　設定 Slave Server 其實很簡單，請參考以下的範例：<br>
<br>
<table width="100%">
  <tr> 
    <td nowrap bgcolor="#000000"><font color="#FFFFFF">slave:~ # <font color="#FFFF00"><strong>vi 
      /etc/named.conf</strong></font><br>
      <font color="#00FFFF" size="2">// 以下 root zone 及本機正反解的 zone 就省略掉，只針對需要做設定的地方做說明。</font><br>
      <font face="細明體">zone &quot;paching.idv.tw&quot; in {<br>
      　　　　type slave;<br>
      　　　　file &quot;slave/paching.idv.tw.slave.db&quot;;<br>
      　　　　masters { 220.132.78.75; };<br>
      };</font><br>
      </font><font color="#00FFFF">&nbsp;</font><font color="#FFFFFF"><font color="#00FFFF" size="2">// 
      </font></font><font color="#00FFFF" size="2">將 Master 所管理的 zone 設定進來，並指定這個區域的名稱伺服器類型為 
      <strong>slave</strong>，資料庫<br>
      </font><font color="#FFFFFF"><font color="#00FFFF" size="2">// </font></font><font color="#00FFFF" size="2">檔案是在 
      /var/lib/named/slave/paching.idv.tw.slave.db。<br>
      </font><font color="#FFFFFF"><font color="#00FFFF" size="2">// </font></font><font color="#00FFFF" size="2">最後則使用 
      masters 來指出 Master DNS 位址，這樣 Slave 才曉得要向誰更新資料庫裡的資料。</font><font color="#FFFFFF"> 
      <br>
      <br>
      <font face="細明體">zone &quot;78.132.220.in-addr.arpa&quot; in {<br>
      　　　　type slave;<br>
      　　　　file &quot;slave/220.132.78.slave.db&quot;;<br>
      　　　　masters { 220.132.78.75; }; <br>
      }; </font></font><font color="#00FFFF" size="2"><br>
      </font><font color="#FFFFFF"><font color="#00FFFF" size="2">// </font></font><font color="#00FFFF" size="2">反解區域的部分就如法炮製一下吧 
      !</font><font color="#FFFFFF">&nbsp; </font></td>
  </tr>
</table>
<br>
　完成後就可以啟動 named 服務了：<br>
<br>
<table width="50%" border="0" bgcolor="#CCCCCC">
  <tr> 
    <td height="25" nowrap>slave:~ # <strong>rcnamed start</strong></td>
  </tr>
</table>
<p> 　接著您可以切換至 /var/lib/named/slave 目錄，找找看有沒有多出 <font color="#000000">paching.idv.tw.slave.db</font> 
  及 220.132.78.slave.db 這兩個檔案，而此檔案內容就是從 Master 所複製過來的。</p>
<p><strong><font size="+1"><a name="45"></a><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"> 
  指定 zone file 位置問題</font></strong></p>
<p>　如果剛剛設定 zone 時，zone file 不是指定在 slave 目錄中，比如<strong>「</strong>file &quot;paching.idv.tw.slave.db&quot;;<strong>」</strong>及<strong>「</strong>file 
  &quot;220.132.78.slave.db&quot;;<strong>」</strong>，那麼將來在做 zone transfer 的時候，可能會出現狀況噢，以下會教大家如何克服這方面的問題。<br>
  <br>
  　 首先請了解一下 /var/lib/named 目錄的權限：</p>
<table width="100%" border="0">
  <tr> 
    <td height="40" bgcolor="#000000"><font color="#FFFFFF">slave:~ #<font color="#FFFF00"><strong> 
      ls -ld /var/lib/named</strong></font><br>
      drwxr-xr-x　9　<strong>root　root</strong>　384　Oct 31 00:29　<font color="#0099FF"><strong>/var/lib/named</strong></font></font></td>
  </tr>
</table>
<br>
　如果發覺 named 目錄的擁有者是 root 的話，那可就大事不妙了，因為執行 named 程式的身分為 named 這個系統帳號：<br>
<br>
<table width="100%" border="0">
  <tr> 
    <td height="58" bgcolor="#000000"><font color="#FFFFFF">slave:~ #<font color="#FFFF00"> 
      <strong>ps aux | grep named</strong></font><br>
      <strong>named</strong>　 6837 　0.0 　1.0 　10808 　2676 　? 　Ss 　00:55 　0:00 
      　/usr/sbin/named<br>
      -t /var/lib/named -u named</font></td>
  </tr>
</table>
<br>
　而此帳號對 /var/lib/named 根本不具寫入權限，因此會造成 Master 上的資料庫無法傳送至 Slave 裡，所以先修改一下權限囉：<br>
<br>
<table width="50%" border="0" bgcolor="#CCCCCC">
  <tr> 
    <td height="27" nowrap>slave:~ # <strong>chown -R named.named /var/lib/named</strong></td>
  </tr>
</table>
<p>　在 SLES 9 裡，您做好了以上的修改後就可以了，但在 SLES 10 中還要注意到 AppArmor 問題。由於 SuSE 提供給 zone file 
  所存放的標準配置目錄是 /var/lib/named 中的 master 及 slave 目錄，所以如您 Slave 主機的 zone file 不是指定在 
  slave 目錄中，則會被 AppArmor 所阻擋，因此需做個調整：</p>
<table width="100%" border="0">
  <tr> 
    <td height="443" bgcolor="#000000"><font color="#FFFFFF">slave:~ #<font color="#FFFF00"><strong> 
      vi /etc/apparmor.d/usr.sbin.named</strong></font><br>
      <br>
      /usr/sbin/named {<br>
      　#include &lt;abstractions/base&gt;<br>
      　#include &lt;abstractions/nameservice&gt; 
      <p> 　capability net_bind_service,<br>
        　capability setgid,<br>
        　capability setuid,<br>
        　capability sys_chroot,</p>
      <p> 　/** <font color="#FFFF00"><strong>rw</strong></font>,　<font color="#00FFFF" size="2">← 
        這個地方改成 rw 即可。</font><br>
        　/dyn/** rwl,<br>
        　/usr/bin/dnskeygen mix,<br>
        　/usr/bin/dnsquery mix,<br>
        　/usr/sbin/named rmix,<br>
        　/usr/sbin/named-xfer mix,<br>
        　/var/lib/named/** rwl,<br>
        　/var/named/** rwl,<br>
        　/var/run/named.pid wl,<br>
        　/var/run/named/named.pid wl,<br>
        　var/run/ndc wl,<br>
        　/slave/* rw,<br>
        }</p>
      slave:~ # <font color="#FFFF00"><strong>rcapparmor reload</strong></font></font></td>
  </tr>
</table>
<p>　另外使用 YaST 去做修改也行，看您自己吧。搞定之後，記得去測試看看噢。<br>
  <br>
  <br>
  <strong><a name="30"></a><font size="5">12.6.2 保持 Salve 與 Master 的資料同步</font><br>
  </strong><br>
  　如果剛剛您已成功架設起 Slave DNS，則爾後只要 refresh 時間一到，Slave 就會跟 Master 作資料同步的動作，如果發覺 Master 
  上面的序號比自己大，就會做資料更新。不過這裡還有個問題要留意，假使前一刻才剛 Refresh 完畢，而 Master 隨即修改資料庫的部分資料並重新啟動 
  named ，那麼您 Slave 主機能即時做更新嗎 ? 如果非得要等到 refresh 時間到了才能更新，可能就會有一段時間 Master 與 Slave 
  的資料是不同步的。為了要解決這方面的問題，可以有以下兩種做法：</p>
<table width="100%" border="0">
  <tr> 
    <td width="3%" align="center" valign="top">&nbsp;</td>
    <td width="3%" align="center" valign="top"><strong>1</strong>.</td>
    <td width="97%"><strong><font size="4">將 Slave 主機的資料寫入 Master 的 NS 紀錄裡</font></strong><br> <br>
      首先請您先至 named.conf 中找到 &quot;notify no&quot;，並將其註解掉，或者修改成 &quot;notify yes&quot; 
      也行：<br> <br> <table width="100%" border="0">
        <tr> 
          <td bgcolor="#000000"><font color="#FFFFFF">suse:~ # <font color="#FFFF00"><strong>vi 
            /etc/named.conf</strong></font><br>
            <font face="細明體">options { <br>
            　　　　directory &quot;/var/lib/named&quot;; <br>
            　　　　</font><font color="#FFFF00" face="細明體">notify yes</font><font face="細明體">; 
            　<br>
            }; </font></font></td>
        </tr>
      </table>
      <br>
      修改正解區域檔案：<br> <br> <table width="100%" border="0">
        <tr> 
          <td nowrap bgcolor="#000000"><font color="#FFFFFF">suse:~ # <font color="#FFFF00"><strong>vi 
            /var/lib/named/master/paching.idv.tw.db</strong></font><br>
            <font color="#00FFFF">;</font><font color="#00FFFF" size="2"> 正解部分請補上 
            slave dns 的 NS 紀錄及 A 紀錄即可。</font><br>
            </font><font color="#FFFFFF" face="細明體">$TTL 43200<br>
            $ORIGIN paching.idv.tw.<br>
            @　　　　 IN　　SOA　　dns.paching.idv.tw.　root.paching.idv.tw.　(<br>
            　　　　　　2006122501 <font color="#0099FF">; serial</font><br>
            　　　　　　21600<font color="#0099FF"> ; refresh</font><br>
            　　　　　　5400 <font color="#0099FF">; retry</font><br>
            　　　　　　864000<font color="#0099FF"> ; expire<br>
            </font>　　　　　　86400　)<font color="#0099FF"> ; minumum</font><br>
            　　　　　IN　　NS 　　dns.paching.idv.tw.<strong><br>
            </strong></font><font color="#FFFFFF"><font color="#FFFF00" face="細明體">　　　　　IN　　NS　　 
            slave.paching.idv.tw.</font></font><font color="#FFFFFF" face="細明體"><strong><br>
            </strong> 　　　　　IN　　MX　10 mail.paching.idv.tw.<br>
            dns　　　 IN　　A 　　 220.132.78.75<br>
            </font><font color="#FFFFFF"><font color="#FFFF00" face="細明體">slave　 
            　IN　　A 　　 61.231.111.33</font></font><font color="#FFFFFF" face="細明體"><br>
            mail　　　IN　　A　　　220.132.78.100<br>
            ftp　　　 IN　　A　　　220.132.78.150<br>
            web　　　 IN　　A　　　220.132.78.200<br>
            www　　　 IN 　 CNAME　web</font><font color="#FFFFFF">&nbsp; </font> </td>
        </tr>
      </table>
      <br>
      修改反解區域檔案： <br> <br> <table width="100%" border="0">
        <tr> 
          <td nowrap bgcolor="#000000"><font color="#FFFFFF">suse:~ # <font color="#FFFF00"><strong>vi 
            /var/lib/named/master/220.132.78.db</strong></font><br>
            <font color="#00FFFF">; </font><font color="#00FFFF" size="2">反解部分補上一筆 
            NS 紀錄即可。</font><br>
            </font><font color="#FFFFFF" face="細明體">$TTL 43200<br>
            $ORIGIN 78.132.220.in-addr.arpa.<br>
            @　　IN　　SOA　　dns.paching.idv.tw.　root.paching.idv.tw.　(<br>
            　　　　　 2006122501 <font color="#0099FF">; serial</font><br>
            　　　　　 21600<font color="#0099FF"> ; refresh</font><br>
            　　　　　 5400 <font color="#0099FF">; retry</font><br>
            　　　　　 864000<font color="#0099FF"> ; expire</font><br>
            　　　　　 86400　)<font color="#0099FF"> ; minumum<br>
            </font>　　 IN　　NS　　 dns.paching.idv.tw.<font color="#FFFF00"> </font></font><font color="#FFFFFF"><font color="#FFFF00" face="細明體"><br>
            　　 IN 　 NS　　 slave.paching.idv.tw.</font></font><font color="#FFFFFF" size="2" face="細明體"><br>
            　　　　　 　<font color="#00FFFF">：略</font></font><font color="#00FFFF" face="細明體">　　<font size="2">　　　　：略</font></font><font color="#FFFFFF">&nbsp; 
            </font> </td>
        </tr>
      </table>
      <br>
      這樣一來，只要將來修改了 Master 的資料庫並重新啟動 named 後，Master 就會送出一個 notify 訊號，來通知給所有資源紀錄中除 
      Master 外的其他 NS 主機 (Slave 主機)，接著 Slave 當然就會嘗試與 Master 作資料同步囉 ! </td>
  </tr>
  <tr> 
    <td align="center" valign="top">&nbsp;</td>
    <td align="center" valign="top">&nbsp;</td>
    <td>&nbsp;</td>
  </tr>
  <tr> 
    <td align="center" valign="top">&nbsp;</td>
    <td align="center" valign="top"><strong>2</strong>.</td>
    <td><strong><font size="4">設定 also-notify</font></strong><br> <br>
      如您不想將 Slave 的 NS 紀錄寫入資料庫的話，還有另一種方式，就是使用 <strong>also-notify</strong> 來指定您想對哪些 
      Slave 主機送出 notify 的通知訊號。also-notify 可以設定在 named.conf 的 global 或 zone section 
      裡，這裡就以 global 的設定來作範例：<br> <br> <table width="100%" border="0">
        <tr> 
          <td bgcolor="#000000"> <p><font color="#FFFFFF">suse:~ # <font color="#FFFF00"><strong>vi 
              /etc/named.conf</strong></font><br>
              <font face="細明體">options { <br>
              　　　 directory &quot;/var/lib/named&quot;; <br>
              　　　 </font><font color="#FF0000"><font color="#FFFFFF" face="細明體">notify 
              yes;</font><font face="細明體">　<br>
              <font color="#FFFFFF">　</font> </font><font color="#FFFFFF" face="細明體">　　</font><font color="#FFFFFF"><font color="#FFFF00" face="細明體">also-notify 
              { 61.231.111.33; };</font></font></font><font face="細明體"><br>
              }; <br>
              </font> <font color="#00FFFF" size="2"># 如果您有兩台 slave 主機，可這麼設定：<br>
              # also-notify { 61.231.111.33 ; 61.231.111.55; };</font><br>
              </font></p></td>
        </tr>
      </table></td>
  </tr>
</table>
<strong><font color="#0000FF"><font size="+1"> <br>
</font></font></strong><font color="#000000">　接下來的練習，就交給您自己囉。</font><font color="#0000FF"><font size="+1"><strong><br>
<br>
<a name="31"></a><font size="6">12.7 子網授權</font></strong></font></font><br>
<br>
　如果本身已經有了一個合法的 domain name，則能夠在這個 domain 下再去建立一個以上的 sub-domain (子網域 )，並且可以授權給 
sub-domain 裡的&nbsp;DNS 去管理主機紀錄，這就是子網授權的意義。<br>
<br>
　本節主要就是在講述上層的 DNS 要如何設定，才能算是完成授權的動作，這其中包含了正解授權及反解授權。而在您了解了子網授權的相關設定之後，就可以知道 Internet 
上的 DNS 當初是如何進行授權的，這將讓您對 DNS 的授權觀念有更進一步的認識。<br>
<br>
　以下設定所使用的 domain name 為自訂的 paching.com，其下的 sub-domain 就暫定為 barry.paching.com，且主機位址都是使用 
private address，這樣的環境也方便讀者在家裡自己練習。<br>
<br>
　下面是待會實作時使用到的相關資訊：<br>
<table width="59%" border="1">
  <tr> 
    <td width="10%" align="center" valign="middle" nowrap bgcolor="#CCCCCC"><font color="#000099">domain</font></td>
    <td width="90%"><table width="100%" border="0">
        <tr> 
          <td width="13%" align="left" valign="top" nowrap><font color="#000099">domain 
            name :</font></td>
          <td width="87%"><font color="#000099">paching.com</font></td>
        </tr>
        <tr> 
          <td align="left" valign="top" nowrap><font color="#000099">name server 
            :</font></td>
          <td><font color="#000099">dns.paching.com ( 192.168.1.1)</font></td>
        </tr>
      </table></td>
  </tr>
  <tr> 
    <td align="center" valign="middle" nowrap bgcolor="#CCCCCC"><font color="#000099">sub-domain</font></td>
    <td><table width="100%" border="0">
        <tr> 
          <td width="13%" align="left" valign="top" nowrap><font color="#000099">domain 
            name :</font></td>
          <td width="87%"><font color="#000099">barry.paching.com</font></td>
        </tr>
        <tr> 
          <td align="left" valign="top" nowrap><font color="#000099">name server 
            :</font></td>
          <td><font color="#000099">subdns.barry.paching.com ( 192.168.1.130)</font></td>
        </tr>
      </table></td>
  </tr>
</table>
<strong><br>
<font size="+1"><a name="32"></a><font size="5">12.7.1 子網正解授權</font></font></strong><font size="+1"><br>
</font><br>
　這裡會分兩部分來做設定，第一部份需先搞定上游 DNS 的授權動作，完成後才能進行第二部分 sub-domain DNS 的設定。<br>
<br>
<strong><font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"></font> 
<font size="4">在 dns.paching.com 主機上的設定</font></strong><br>
<br>
<table width="100%" border="0">
  <tr> 
    <td nowrap bgcolor="#000000"><font color="#00FF00">1. 設定 named.conf</font><font color="#FFFFFF"><br>
      <br>
      dns:~ #<font color="#FFFF00"><strong> vi /etc/named.conf</strong></font><br>
      <br>
      <font face="細明體">zone &quot;paching.com&quot; in {<br>
      　　　　type master;<br>
      　　　　file &quot;master/paching.com.db&quot;;<br>
      };<br>
      <br>
      zone &quot;1.168.192.in-addr.arpa&quot; in {<br>
      　　　　type master;<br>
      　　　　file &quot;master/192.168.1.db&quot;;<br>
      };</font> <br>
      <br>
      <font color="#00FF00">2. 設定正解區域</font><br>
      <br>
      dns:~ #<font color="#FFFF00"><strong> vi /var/lib/named/master/paching.com.db</strong></font><br>
      <br>
      <font face="細明體">$TTL 43200<br>
      $ORIGIN paching.com.</font><br>
      </font><font color="#FFFFFF" face="細明體">@　　　　　　 IN　　SOA　　dns.paching.com. 
      　root.paching.com. 　(　<br>
      　　　　　　2006122601　21600　5400　864000　86400　)<br>
      　　　　 　　 IN　　NS　　 dns.paching.com.<br>
      </font><font color="#FFFFFF"> <font color="#FFFF00" face="細明體">barry　　　　 
      IN　　NS　　 subdns.barry.paching.com.<strong>　</strong></font><font size="2"><br>
      </font><font color="#00FFFF">; <font size="2">增加一筆 sub-zone 的 NS 紀錄。</font></font><font size="2"><br>
      <br>
      </font><font face="細明體">dns　　　　　 IN　　A</font></font><font color="#FFFFFF" face="細明體">　　　192.168.1.1<strong><br>
      </strong></font><font color="#FFFFFF"><font color="#FFFF00" face="細明體">subdns.barry　IN　　A　　　192.168.1.130</font></font><font color="#FFFFFF" face="細明體"><font color="#FFFF00">　</font></font><font color="#FFFFFF"><strong><br>
      </strong><font color="#00FFFF">; </font></font><font color="#00FFFF" size="2">這是 
      sub-zone 那台 DNS 的 A 紀錄。<br>
      </font><font color="#FFFFFF"><font color="#00FFFF">; </font></font><font color="#00FFFF" size="2">以上多增加兩筆的設定，就是在做子網正解授權。<br>
      </font><font color="#FFFFFF" size="2"><br>
      </font><font color="#FFFF00" face="細明體">$GENERATE　2-120　host$　A　192.168.1.$ 
      </font><font color="#FFFFFF"><strong><br>
      </strong><font color="#00FFFF">;<font size="2"> $GENERATE 是用來產生其後所指定的那一段數值範圍，而 
      &quot;$&quot; 就是指這些數值，</font><br>
      ; <font color="#FFFFFF"><font color="#00FFFF"><font color="#FFFFFF"><font color="#00FFFF"><font size="2">所以</font></font></font><font size="2">實際上</font></font></font><font size="2">將其展開後就變成這個樣子：</font><br>
      ; <font size="2">host2　　IN　A　192.168.1.2</font><br>
      ; <font size="2">host3　　IN　A　192.168.1.3</font><br>
      ; <font size="2">host4　　IN　A　192.168.1.4</font><br>
      ;<font size="2">　 ：　　　　　 　： </font><br>
      ;<font size="2"> host120　IN　A　192.168.1.120</font><br>
      ;<font size="2"> 另外使用 $GENERATE 時，在 RR-type 之前，不需指定 &quot;IN&quot;。</font></font></font><font color="#00FFFF" size="2">&nbsp; 
      </font> <font color="#FFFFFF"><br>
      <br>
      <font color="#00FF00">3. 設定反解區域</font><br>
      <br>
      dns:~ # <font color="#FFFF00"><strong>vi /var/lib/named/master/192.168.1.db</strong></font><br>
      <br>
      <font face="細明體">$TTL 43200<br>
      $ORIGIN 1.168.192.in-addr.arpa. </font><br>
      </font><font color="#FFFFFF" face="細明體">@　　　IN　　SOA　　dns.paching.com. 　root.paching.com. 
      (<br>
      　　 　2006122601　21600　5400　864000　86400　)<br>
      　　 　IN　　NS　　 dns.paching.com.<br>
      1　　　IN　　PTR　　dns.paching.com.<br>
      </font><font color="#FFFFFF"> <font color="#FFFF00" face="細明體">$GENERATE　2-120　$　PTR　host$.paching.com.</font><br>
      </font> <font color="#00FFFF">; </font><font color="#00FFFF" size="2">這裡也是使用 
      $GENERATE 來簡化反解的設定。實際展開後是：</font><font size="2"><br>
      </font><font color="#00FFFF">;<font size="2"> 2　　IN　PTR　host2.paching.com.</font></font> 
      <font size="2">&nbsp;</font><br> <font color="#00FFFF">; <font size="2">3　　IN　PTR　host3.paching.com.</font></font> 
      <font size="2">&nbsp;</font><br> <font color="#00FFFF">; </font><font size="2"><font color="#00FFFF"> 
      　　 ：</font>　　　<font color="#00FFFF">　　 　：</font></font><br> <font color="#00FFFF">; 
      <font size="2">120　IN　PTR　host120.paching.com.</font></font> </td>
  </tr>
</table>
<br>
　現在上層 DNS 已經完成正解授權動作了，接著您就可以到負責 sub-zone 的那台 DNS 去做相關的設定。<strong><br>
<br>
<font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"></font> 
<font size="4">在 subdns.barry.paching.com &nbsp;主機上的設定</font></strong><br>
<br>
<table width="100%" border="0" bgcolor="#000000">
  <tr> 
    <td nowrap><font color="#FFFFFF">subdns:~ #<font color="#FFFF00"><strong> 
      vi /etc/named.conf<br>
      <br>
      </strong><font color="#FFFFFF" face="細明體">zone &quot;barry.paching.com&quot; 
      in {<br>
      　　　　type master;<br>
      　　　　file &quot;master/barry.paching.com.db&quot;;<br>
      }; <br>
      <br>
      zone &quot;paching.com&quot; in {<br>
      　　　　type forward;<br>
      　　　　forwarders { 192.168.1.1; };<br>
      }; </font><font color="#FFFFFF"><br>
      <font color="#00FFFF"># </font></font><font color="#00FFFF" size="2">這裡額外設定了一個上層的 
      zone 進來，且 type 使用<strong> </strong>forward，<strong> </strong>forwarders 
      則設定為 </font><font color="#FFFFFF"><br>
      <font color="#FFFF00"><font color="#FFFFFF"><font color="#00FFFF"># </font><font color="#FFFFFF"><font color="#FFFF00"><font color="#00FFFF" size="2">上層的 
      DNS 位址。此</font></font></font></font></font><font color="#00FFFF" size="2">代表著說</font></font><font color="#00FFFF" size="2">，只要是有關 
      paching.com 這個 domain 裡邊的主機查詢，</font><font color="#FFFFFF"><br>
      <font color="#FFFF00"><font color="#FFFFFF"><font color="#00FFFF"># </font><font color="#FFFF00"><font color="#00FFFF" size="2">都會轉給</font></font></font><font color="#00FFFF" size="2">上層的 
      DNS，</font></font><font color="#00FFFF" size="2">如此一來，您這台 dns 就不需</font></font><font color="#00FFFF" size="2">幫它們從 
      root ns 查詢起了。</font><font color="#FFFFFF"><br>
      <font color="#FFFF00"><font color="#FFFFFF"><font color="#00FFFF"># </font></font></font></font><font color="#00FFFF" size="2">不過萬一上層 
      DNS 查詢不到時，那您這台 DNS 還是得再幫忙查詢，除非加上</font><font color="#FFFFFF"><br>
      <font color="#FFFF00"><font color="#FFFFFF"><font color="#00FFFF"># </font></font></font> 
      <font color="#FFFF00"><font color="#00FFFF" size="2"> &quot;forward only;&quot; 
      </font></font></font><font color="#00FFFF" size="2">來完全依賴 forwarder，意即 forwarder 
      查詢不到時，本身這台<br>
      </font><font color="#FFFFFF"><font color="#FFFF00"><font color="#FFFFFF"><font color="#FFFF00"><font color="#FFFFFF"><font color="#00FFFF"># 
      </font></font></font> </font></font></font><font color="#00FFFF" size="2">DNS 也不會自行向外面作查詢。</font><font color="#FFFFFF"><br>
      </font></font></font> <br> <font color="#FFFFFF">subdns:~ # <font color="#FFFF00"><strong>vi 
      /var/lib/named/master/barry.paching.com.db <br>
      <br>
      </strong></font><font color="#FFFFFF" face="細明體">$TTL 43200<br>
      $ORIGIN barry.paching.com.</font><font color="#FFFFFF"><br>
      </font><font color="#FFFFFF" face="細明體">@　　　 IN　　SOA　　subdns.barry.paching.com. 
      　admin.barry.paching.com. (　<br>
      　　　　2006122601　21600　5400　864000　86400　)<br>
      　　 　 IN　　NS　　 subdns.barry.paching.com.<br>
      subdns　IN　　A　　　192.168.1.130<br>
      $GENERATE　131-250　host$　A　192.168.1.$ </font> </font> </td>
  </tr>
</table>
<br>
　到這裡應該都還沒什麼問題吧 !<br>
<br>
<font size="+1"><strong><a name="33"></a><font size="5">12.7.2 子網反解授權</font></strong></font><br>
<br>
　如果現在想把 192.168.1.{130-250} 這個 IP 位址範圍，也授權給 sub-zone 的 DNS 來管理的話，那可就好玩了。對於不滿一組 
class C 的反解授權，可沒那麼輕鬆，因為上層 DNS 必須先指定好這個不滿一組 class C 的 IP 反解區域名稱，並且須指出這個區域的授權主機是哪一台，等這些都搞定後，才能至 
sub-zone 的 DNS 繼續設定。請直接看以下的範例說明。<br>
<br>
<strong><font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"></font> 
<font size="4">在 dns.paching.com 主機上的設定</font></strong><br>
<br>
<table width="100%" border="0">
  <tr> 
    <td nowrap bgcolor="#000000"><font color="#FFFFFF">dns:~ #<font color="#FFFF00"><strong> 
      vi /var/lib/named/master/192.168.1.db<br>
      </strong></font><br>
      <font face="細明體">$TTL 43200<br>
      $ORIGIN 1.168.192.in-addr.arpa. </font><br>
      </font><font color="#FFFFFF" face="細明體">@　　　　IN　　　SOA　　　dns.paching.com. 
      　root.paching.com. 　(　<br>
      　　　 　2006122601　21600　5400　864000　86400　)<br>
      　　　 　IN　　　NS　　　 dns.paching.com.<br>
      </font><font color="#FFFFFF"><font color="#FFFF00" face="細明體">130-250　IN　　　NS　　　 
      subdns.barry.paching.com.<br>
      $GENERATE　130-250　$　CNAME　$.130-250</font></font><font color="#FFFFFF" face="細明體"><strong><br>
      </strong></font><font color="#FFFFFF"><strong><font color="#00FFFF"># <font size="2">補上以上兩行</font></font></strong></font><font color="#FFFFFF" face="細明體"><strong><br>
      <br>
      </strong>1　　　　IN　　　PTR 　　 dns.paching.com.<br>
      $GENERATE　　2-120　$　PTR　host$.paching.com.</font> </td>
  </tr>
</table>
<br>
　來看看新增加那兩行的意義，先解釋第一行的設定，130-250.1.168.192.in-addr.arpa 是打算授權給 sub-zone 的 DNS 在設反解時所使用的反解區域名稱。而整筆的設定就是在宣告 
130-250.1.168.192.in-addr.arpa 這個 zone 所負責的 DNS 為 subdns.barry.paching.com. 這台主機。<br>
<br>
　再來看第二行的設定，先把它展開來看，會比較清楚：<br>
<br>
<table width="45%" border="0" bgcolor="#CCCCCC">
  <tr> 
    <td nowrap><font face="細明體">130　IN　CNAME　130.130-250<br>
      131　IN　CNAME　131.130-250<br>
      132　IN　CNAME　132.130-250<br>
      　　　　　：　 　：<br>
      250　IN　CNAME　250.130-250 </font></td>
  </tr>
</table>
<br>
　取展開後的第二筆跟剛剛那一筆 NS 紀錄合併起來看：<br>
<br>
<table width="60%" border="0" bgcolor="#CCCCCC">
  <tr> 
    <td><font color="#000000" face="細明體">$ORIGIN　1.168.192.in-addr.arpa. <br>
      130-250　IN　NS　　 subdns.barry.paching.com.<br>
      131　　　IN　CNAME　131.130-250 </font></td>
  </tr>
</table>
<br>
　當一開始查詢 192.168.1.131 的反解時，會先找到 1.168.192.in-addr.arpa. 這個 zone 所負責的 DNS，也就是 dns.paching.com，然後再根據其反解區域檔案來查詢 
131.1.168.192.in-addr.arpa.，接著又因為這個紀錄項使用 CNAME 的關係，因而等於是查詢 CNAME 右邊的 131.130-250.1.168.192.in-addr.arpa.，又從這裡的 
NS 紀錄得知 130-250.1.168.192.in-addr.arpa. 這個 zone 所負責的 DNS 為 subdns.barry.paching.com.，所以最後就根據正解區域檔案找到了這台主機的位址。透過這樣的設定，就可以把 
192.168.1.{130~250} 這段 IP 的反解授權出去囉。緊接著就要趕快到被授權的主機 subdns 去做相關的設定。<br>
<br>
<strong><font size="+1"><img src="../picture/1775.gif" tppabs="http://www.suse.url.tw/picture/1775.gif" width="18" height="18"></font> 
<font size="4">在 subdns.barry.paching.com &nbsp;主機上的設定</font></strong><br>
<br>
<table width="100%" border="0" bgcolor="#000000">
  <tr> 
    <td nowrap><font color="#FFFFFF">subdns:~ #<font color="#FFFF00"><strong> 
      vi /etc/named.conf</strong></font></font><br> <font color="#00FFFF" size="2"><br>
      // 補上以下兩個 zone。</font> <br> <font color="#FFFFFF"><br>
      <font face="細明體">zone &quot;130-250.1.168.192.in-addr.arpa&quot; in {<br>
      　　　　type master;<br>
      　　　　file &quot;master/192.168.1.130-250.db&quot;;<br>
      };<br>
      <br>
      zone &quot;1.168.192.in-addr.arpa&quot; in {<br>
      　　　　type forward;<br>
      　　　　forwarders { 192.168.1.1; };<br>
      }; </font><strong><br>
      </strong><br>
      subdns:~ # <font color="#FFFF00"><strong>vi /var/lib/named/master/192.168.1.130-250.db</strong></font><br>
      <br>
      <font color="#FFFFFF" face="細明體">$TTL 43200<br>
      $ORIGIN 130-250.1.168.192.in-addr.arpa.</font><font color="#FFFFFF"><br>
      </font><font color="#FFFFFF" face="細明體">@　　IN　　SOA　　subdns.barry.paching.com. 
      　admin.barry.paching.com. (　<br>
      　　　　　 2006122601　21600　5400　864000　86400　)<br>
      　　 IN　　NS　　 subdns.barry.paching.com.<br>
      130　IN　　PTR　　subdns.barry.paching.com.<br>
      </font><font color="#FFFFFF"><font color="#FFFF00" face="細明體">$GENERATE　131-250　$　PTR　host$.barry.paching.com.</font> 
      </font> </font> </td>
  </tr>
</table>
<p> 　完成後，可找一台主機當成 client 端，並使用 nslookup 或 dig 測試看看噢。<br>
  <br>
  　而在實際的環境中，對於不滿一個 class C 時，可讓 ISP 幫您設定反解，以 hinet 來說，只要進入 <a href="javascript:if(confirm(%27http://hidomain.hinet.net/hidns.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://hidomain.hinet.net/hidns.html%27" tppabs="http://hidomain.hinet.net/hidns.html" target="_blank">http://hidomain.hinet.net/hidns.html</a> 
  這個網站進行登錄即可。當然如果 ISP 有提供這方面授權的話，那您可要親自與其接洽一下，因為每家 ISP 的授權模式未必相同。</p>
<blockquote>
  <p><font color="#000099"><strong>Tips：</strong></font><font color="#000099" size="2">以上所舉的這個反解範例可能不是很恰當，因為這裡只是要讓各位了解反解授權的觀念，且方便各位實作的環境而已。以 
    class C 來說， ISP 通常會先切割成幾個 subnet，如果是 8 個 subnet 的話，那每個 subnet 就擁有 32 個位址，它可以分別把這 
    8 個 subnet 分配給八家公司來使用，那如果 ISP 允許不滿 class C 反解授權的話，就像之前提到的，需先與 ISP 做接洽來了解其授權模式，等 
    ISP 那邊搞定之後，您才可以開始作相關的設定。<br>
    如果您的實作環境裡又牽扯到子網切割的問題，可能會使您更加頭痛，因此本範例才會使用同一個網路段的方式來實作。</font></p>
</blockquote>
<p><font color="#0000FF"><font size="+1"><strong><a name="34"></a><font size="6">12.8 
  ACL 存取控制清單</font><font size="+2"><br>
  </font></strong></font><font color="#000000" size="+1"><br>
  </font><font color="#000000">　在設定 named.conf 時，可以藉著自行定義的 ACL，來將其運用在您的設定檔中。不過這裡先針對幾個可以設定在 
  options 或 zone 之中的項目先行做個說明，然後再與 ACL 搭配起來使用：</font></font> </p>
<table width="100%" border="1">
  <tr> 
    <td width="11%" align="center" valign="middle" nowrap><strong><font color="#000099">allow-update 
      </font></strong></td>
    <td width="89%"><font color="#000099">是否允許 client 端更新自己在 DNS 上的紀錄，預設為 &quot; 
      <strong>allow-update { none; }; </strong>&quot;，表示都拒絕之意。</font></td>
  </tr>
  <tr> 
    <td align="center" valign="middle" nowrap><strong><font color="#000099">allow-transfer 
      </font></strong></td>
    <td><font color="#000099">是否允許其他主機做區域移轉 (zone-transfer)，預設為 &quot; <strong>allow-transfer 
      { any; };</strong> &quot;，代表都允許之意。<br>
      如果您有兩台 Slave 主機，則在 Master 上頭可以設定只允許這兩台 Slave 做 zone-transfer：<br>
      <strong>allow-transfer { 192.168.1.100 ; 192.168.1.200 ; };<br>
      </strong>至於其他的 Slave 主機上頭可這麼設定：<strong><br>
      allow-transfer { none ; };</strong></font></td>
  </tr>
  <tr> 
    <td align="center" valign="middle" nowrap><strong><font color="#000099">allow-query 
      </font></strong></td>
    <td><font color="#000099">是否允許 client 端的查詢，預設為 &quot; <strong>allow-query 
      { any; }; </strong>&quot;。<br>
      當然這個地方也可以對來源端做控管，等等會有說明。</font></td>
  </tr>
</table>
<br>
<strong>ACL 設定語法</strong>：<br>
<table width="100%" border="0" bgcolor="#CCCCCC">
  <tr> 
    <td><strong><font face="細明體">acl string {address_match_element; ...};</font></strong></td>
  </tr>
</table>
<br>
<strong>　</strong>string 是您自行指定的 acl 名稱，至於 { } 內可以是個網路段或主機位址，之間使用 &quot; ; &quot; 
隔開即可。<br>
<strong><br>
範例說明</strong>：<br>
<table width="100%" border="0">
  <tr> 
    <td nowrap bgcolor="#000000"> <p><font color="#FFFFFF">suse:~ #<strong><font color="#FFFF00"> 
        vi /etc/named.conf</font></strong><br>
        <br>
        <font face="細明體">acl slave_host {<br>
        　　　　192.168.1.100;192.168.1.200;192.168.1.222; <br>
        };<br>
        <br>
        acl source_query {<br>
        　　　　192.168.2.0/24;192.168.3.0/24;<br>
        };<br>
        <br>
        options { <br>
        　　　　directory &quot;/var/lib/named&quot;; <br>
        　　　　notify yes; <br>
        　　　　allow-update { none ; };<br>
        }; </font><strong><br>
        </strong><font color="#00FFFF"># </font></font><font color="#00FFFF" size="2">在全域宣告裡，設定不允許動態更新。另外當 
        named 重新啟動時，會對 zone file 裡<br>
        </font><font color="#FFFFFF"><font color="#00FFFF"># </font></font><font color="#00FFFF" size="2">有設定 
        NS 紀錄的主機 (Master 除外) 送出 notify 訊號。<br>
        <br>
        </font><font color="#FFFFFF" face="細明體">zone　&quot;paching.idv.tw&quot; 
        in {<br>
        　　　　type master;<br>
        　　　　file &quot;master/paching.idv.tw.db&quot;;<br>
        　　　　allow-query { source_query; };<br>
        　　　　allow-transfer { slave_host; };<br>
        };</font><font color="#FFFFFF"><br>
        <font color="#00FFFF"># </font></font><font color="#00FFFF" size="2">使用 
        allow-query 來限定允許查詢的來源端，使用 allow-transfer 來限定可以做<br>
        </font><font color="#FFFFFF"><font color="#00FFFF"># </font></font><font color="#00FFFF" size="2"></font><font color="#00FFFF" size="2">zone-transfer 
        的主機。<br>
        <br>
        </font><font color="#FFFFFF" face="細明體">zone　&quot;1.168.192.in-addr.arpa&quot; 
        in {<br>
        　　　　type master;<br>
        　　　　file &quot;master/192.168.1.db&quot;;<br>
        　　　　allow-query { source_query; };<br>
        　　　　allow-transfer { slave_host; };<br>
        }; </font> </p></td>
  </tr>
</table>
<font color="#FF0000"><font color="#000000"><br>
<font size="+1"><strong><font color="#0000FF"><a name="35" id="35"></a><font size="6">12.9 
Bind 9 所提供的 view 功能</font></font><br>
</strong></font><br>
　如果您想讓 DNS 能把內部與外部的查詢分開，就要使用 bind view 的功能。比如您在區網內架設了一台 Web Server，當內外部利用此台 DNS 
查詢 Web Server 的位址時，就會得到不同的結果。另外如果有一些主機，您只想提供內部來做存取，並不打算對外開放，也可利用 bind view 來做個區隔。<br>
　　<br>
　以下我們就以 paching.idv.tw 這個 zone 為範例，來看看在 Master 主機上如何做設定：<br>
</font></font> 
<table width="100%" border="0">
  <tr> 
    <td nowrap bgcolor="#000000"> <p><font color="#FFFFFF">suse:~ #<strong><font color="#FFFF00"> 
        vi /etc/named.conf</font></strong><br>
        <br>
        <font color="#00FFFF" size="2">// 請注意，當使用 bind view 功能時，不能將 zone 設定在 view 
        之外。<br>
        // 另外 recursion 參數可以設定在 options 或 view 之中，但不能設定在 zone 裡面。<br>
        </font><br>
        <font face="細明體">acl Lan { 192.168.1.0/24; }; <br>
        <br>
        options { <br>
        　　　　directory &quot;/var/lib/named&quot;;<br>
        }; <br>
        <br>
        view &quot;internal&quot; {<br>
        　　　　match-clients { Lan;127.0.0.1; };</font>　<font color="#00FFFF" size="2"><br>
        　　　　　</font><font color="#00FFFF"># </font><font color="#00FFFF" size="2">設定提供給內部查詢的來源端。<br>
        </font><br>
        　　　　<font face="細明體">recursion yes;<strong>　</strong></font><font color="#00FFFF" size="2"><br>
        　　　　　</font><font color="#FFFFFF"><font color="#00FFFF"># </font></font><font color="#00FFFF" size="2">允許遞迴查詢。</font><br>
        <br>
        　　　　<font face="細明體">zone &quot;.&quot; in {<br>
        　　　　　　　　　type hint;<br>
        　　　　　　　　　file &quot;root.hint&quot;;<br>
        　　　　};<br>
        <br>
        　　　　zone &quot;paching.idv.tw&quot; in {<br>
        　　　　　　　　　type master;<br>
        　　　　　　　　　file &quot;master/paching.idv.tw-in&quot;;</font>　<font color="#00FFFF" size="2"><br>
        　　　　　　　　　　　 </font><font color="#FFFFFF"><font color="#FFFFFF"><font color="#00FFFF"># 
        </font></font></font><font color="#00FFFF" size="2">提供內部查詢時的資料庫檔案名稱。</font><br>
        　　　　<font face="細明體">};<br>
        };</font></font></p>
      <p><font color="#FFFFFF" face="細明體">view &quot;external&quot; {<br>
        　　　　match-clients { any; };　</font><font color="#FFFFFF"><font color="#00FFFF" size="2"><br>
        　　　　　</font><font color="#FFFFFF"><font color="#FFFFFF"><font color="#00FFFF"># 
        </font></font></font><font color="#00FFFF" size="2"> 設定提供給外部所有來源端查詢。</font><br>
        <br>
        　　　　<font face="細明體">recursion no;　</font><font color="#00FFFF" size="2"><br>
        　　　　　</font><font color="#FFFFFF"><font color="#FFFFFF"><font color="#00FFFF"># 
        </font></font></font><font color="#00FFFF" size="2"> 不提供遞迴查詢的服務。</font><br>
        　　　　<br>
        　　　　 <font face="細明體">zone &quot;.&quot; in {<br>
        　　　　　　　　　type hint;<br>
        　　　　　　　　　file &quot;root.hint&quot;;<br>
        　　　　};<br>
        <br>
        　　　　zone &quot;paching.idv.tw&quot; in {<br>
        　　　　　　　　　type master;<br>
        　　　　　　　　　file &quot;master/paching.idv.tw-out&quot;;</font>　<font color="#00FFFF" size="2"><br>
        　　　　　　　　　　　</font><font color="#FFFFFF"><font color="#FFFFFF"><font color="#00FFFF"># 
        </font></font></font><font color="#00FFFF" size="2"> 提供外部查詢時的資料庫檔案名稱。</font><br>
        　　　　<font face="細明體">};<br>
        };</font></font></p></td>
  </tr>
</table>
<font color="#FF0000"><font color="#000000"><br>
　named.conf 設定 ok 後，接著就可以到 /var/lib/named/master 目錄下去設定 paching.idv.tw-in 及 paching.idv.tw-out 
這兩個提供內外部查詢的 zone file，這就交給您自己練習囉。<br>
<br>
</font></font> 
<table width="100%" border="0">
  <tr> 
    <td width="1%" valign="top" nowrap>&nbsp;</td>
    <td width="5%" valign="top" nowrap><font color="#FF0000"><img src="../suse.gif" tppabs="http://www.suse.url.tw/suse.gif" width="39" height="20"></font></td>
    <td width="94%"><font color="#FF0000"><font color="#0000CC">如果您對 Slave 也有興趣研究的話，可以參考網中人的一篇文章：</font></font><br> 
      <font color="#FF0000"><font color="#000000"><a href="javascript:if(confirm(%27http://www.study-area.org/tips/bind9_view.htm  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.study-area.org/tips/bind9_view.htm%27" tppabs="http://www.study-area.org/tips/bind9_view.htm" target="_blank">http://www.study-area.org/tips/bind9_view.htm</a></font></font> 
    </td>
  </tr>
</table>
<font color="#FF0000"><font color="#000000"><br>
</font></font> 
<p align="center"><font color="#FF0000"><font color="#000000"><em>copyright &copy; 
  2006 by barry ( 柏青哥 )</em> <br>
  </font></font></p>
</body>
</html>
